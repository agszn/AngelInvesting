<!-- Buy Modal -->
<div class="modal fade" id="universalBuyModal" tabindex="-1" role="dialog" aria-labelledby="universalBuyModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content" style="border-radius: 10px; overflow: hidden;">
      <form method="POST" action="" id="buy-form">
        {% csrf_token %}
        <div style="background-color: #3a456d; color: white; padding: 12px 20px; display: flex; justify-content: space-between; align-items: center;">
          <div>
            <strong id="buy-stock-name"></strong>
            <span style="color: #7cffaf; margin-left: 10px;" id="buy-share-price"></span>
          </div>
        </div>

        <div style="background-color: #f1f6ff; padding: 20px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
          <input type="hidden" name="stock_id" id="buy-stock-id">

          <div>
            <label for="buy-advisor">Advisor</label>
            <select name="advisor" id="buy-advisor" required style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #ccc;">
              <!-- Populated via JS -->
            </select>
          </div>

          <div>
            <label for="buy-broker">Broker</label>
            <select name="broker" id="buy-broker" required style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #ccc;">
              <!-- Populated via JS -->
            </select>
          </div>

          <div>
            <label>Quantity</label>
            <input type="number" name="quantity" id="stock-quantity" required min="1" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #ccc;">
          </div>

          <div>
            <label>Price per Share</label>
            <input type="number" step="0.01" name="price_per_share" id="buy-price-per-share" required style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #ccc;" data-default-price="0">
          </div>

          <div>
            <label>Order Type</label>
            <div style="margin-top: 5px; font-size: 12px;">
              <label><input type="radio" name="order_type" value="market" checked> Market</label>
              <label style="margin-left: 10px;"><input type="radio" name="order_type" value="limit"> Limit</label>
            </div>
          </div>
        </div>

        <!-- Total Display -->
        <div style="background-color: #3a456d; padding: 15px; display: flex; justify-content: space-between; align-items: center;">
          <span style="color: #fff; font-weight: bold;">Total: ₹<span id="buy-total">0.00</span></span>
          <button type="submit" style="background-color: #4caf50; color: white; padding: 10px 20px; border-radius: 20px; border: none; font-weight: bold;">
            ✔ Place Buy Order
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Sell Modal (unchanged) -->
<div class="modal fade" id="universalSellModal" tabindex="-1" role="dialog" aria-labelledby="universalSellModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content" style="background: white; border-radius: 10px; overflow: hidden;">
      <form method="POST" action="" id="sell-form">
        {% csrf_token %}
        <div style="background-color: #3a456d; color: white; padding: 12px 20px; display: flex; justify-content: space-between; align-items: center;">
          <div>
            <strong id="sell-stock-name"></strong>
            <span style="color: #7cffaf; margin-left: 10px;" id="sell-stock-lot"></span>
          </div>
        </div>

        <div style="background-color: #f1f6ff; padding: 20px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
          <input type="hidden" name="stock_id" id="sell-stock-id">

          <div>
            <label for="sell-advisor">Advisor</label>
            <select name="advisor" id="sell-advisor" required style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #ccc;">
              <!-- Populated via JS -->
            </select>
          </div>

          <div>
            <label for="sell-broker">Broker</label>
            <select name="broker" id="sell-broker" required style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #ccc;">
              <!-- Populated via JS -->
            </select>
          </div>

          <div>
            <label for="sell-quantity">Quantity</label>
            <input type="number" name="quantity" id="sell-quantity" required min="1" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #ccc;">
          </div>
        </div>

        <div style="background-color: #3a456d; padding: 15px; text-align: right;">
          <button type="submit" style="background-color: #f44336; color: white; padding: 10px 20px; border-radius: 20px; border: none; font-weight: bold;">
            ✘ Place Sell Order
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const priceInput = document.getElementById("buy-price-per-share");
    const qtyInput = document.getElementById("stock-quantity");
    const buyTotal = document.getElementById("buy-total");

    const orderTypeRadios = document.querySelectorAll("input[name='order_type']");

    function togglePriceInput() {
      const selectedOrderType = document.querySelector("input[name='order_type']:checked").value;
      const defaultPrice = priceInput.getAttribute("data-default-price");

      if (selectedOrderType === "market") {
        priceInput.value = defaultPrice || 0;
        priceInput.readOnly = true;
      } else {
        priceInput.readOnly = false;
      }
      updateBuyTotal();
    }

    function updateBuyTotal() {
      const qty = parseFloat(qtyInput.value) || 0;
      const price = parseFloat(priceInput.value) || 0;
      buyTotal.textContent = (qty * price).toFixed(2);
    }

    // Attach event listeners
    orderTypeRadios.forEach(radio => radio.addEventListener("change", togglePriceInput));
    qtyInput.addEventListener("input", updateBuyTotal);
    priceInput.addEventListener("input", updateBuyTotal);

    // Initial state
    togglePriceInput();
    updateBuyTotal();
  });
</script>
