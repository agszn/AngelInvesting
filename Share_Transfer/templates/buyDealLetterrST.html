{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Deal Letter - {{ invoice_no }}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #fff;
      color: #000;
      font-size: 14px; /* Default for screen */
      margin: 40px;
    }
    .invoice-box {
      max-width: 900px;
      margin: auto;
      padding: 20px;
      border: 1px solid #ddd;
    }
    .logo {
      max-height: 110px;
    }
    .table td, .table th {
      vertical-align: middle;
    }
    @media print {
      body {
        font-size: 10px; /* Reduced for PDF/print */
        margin: 0;
      }
      .download-button {
        display: none;
      }
    }
  </style>
</head>
<body>

<div class="invoice-box">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-start">
    <div>
      <h5 class="fw-bold">INVOICE</h5>
      <p><strong>Invoice No:</strong> {{ invoice_no }}</p>
      <p><strong>Date:</strong> {{ transaction_date|date:"d-m-Y" }}</p>
      <p><strong>Phone:</strong> +919945164369</p>
      <p><strong>Email:</strong> info@theangelinvesting.com</p>
      <p><strong>Website:</strong> <a href="https://theangelinvesting.com/">theangelinvesting.com</a></p>
    </div>
    <div class="text-end">
      <img src="data:image/png;base64,{{ logo_base64 }}" alt="Logo" class="logo">
    </div>
  </div>

  <hr>

  <!-- Title -->
  <div class="text-center fw-bold my-3">
    {% if user.is_authenticated %}
      {% if user.user_type == 'RM' or user.user_type == 'AC' %}
        <h2>Provisional Deal Letter</h2>
      {% elif user.user_type == 'ST' %}
        <h2>Deal Confirmation Letter</h2>
      {% endif %}
    {% endif %}
  </div>

  <!-- Recipient -->
  <p>
    <strong>To,</strong><br>
    {{ buyer.full_name }}<br>
    {{ buyer.email }}<br>
    {{ buyer.phone }}
  </p>

  <p><b>Dear</b> {{ buyer.full_name }}, </p>
  <br>
    We are pleased to confirm the successful completion of the following stock transaction between you and theangelinvesting.com.
  </p>

  <!-- Client Information -->
  <h6 class="fw-bold mt-4">Client Information</h6>
  <table class="table table-bordered">
    <thead class="table-light">
      <tr>
        <th>Field</th>
        <th>Buyer (You)</th>
        <th>Seller (theangelinvesting.com)</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>Name</td><td>{{ buyer.full_name }}</td><td>{{ seller.full_name }}</td></tr>
      <tr><td>PAN Number</td><td>{{ buyer.pan_number }}</td><td>{{ seller.pan_number }}</td></tr>
      <tr><td>Email</td><td>{{ buyer.email }}</td><td>{{ seller.email }}</td></tr>
      <tr><td>Phone</td><td>{{ buyer.phone }}</td><td>+919945164369</td></tr>
      <tr><td>Client ID</td><td>{{ buyer.client_id }}</td><td>{{ seller.client_id }}</td></tr>
    </tbody>
  </table>

  <!-- Transaction Details -->
  <h6 class="fw-bold mt-4">Transaction Details</h6>
  <table class="table table-bordered">
    <tbody>
      <tr><td><strong>Company Name:</strong></td><td>{{ stock.company_name }}</td></tr>
      <tr><td><strong>Scrip Name:</strong></td><td>{{ stock.scrip_name }}</td></tr>
      <tr><td><strong>Quantity Purchased:</strong></td><td>{{ transaction.quantity }}</td></tr>
      <tr><td><strong>Price per Share:</strong></td><td>₹{{ transaction.price_per_share }}</td></tr>
      <tr><td><strong>Total Purchase Amount:</strong></td><td>₹{{ transaction.total_amount }}</td></tr>
      <tr><td><strong>Mode of Delivery:</strong></td><td>{{ mode_of_delivery }}</td></tr>
    </tbody>
  </table>

  <!-- Signature -->
  <p class="mt-4">Thank you for your trust in AngelInvesting.com.</p>
  <br><br>
  <p><strong>Authorized Signatory</strong><br>theangelinvesting.com</p>

  <!-- Download Button -->
  <div class="download-button text-center mt-4">
    <a href="?order_id={{ transaction.order_id }}&download=pdf" class="btn btn-success">
      ⬇️ Download Deal Letter (PDF)
    </a>
  </div>

</div>

</body>
</html>
