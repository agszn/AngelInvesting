{% extends "baseStructureST.html" %}
{% block title %}Completed Orders Report{% endblock %}

{% block STsubtitle %}Stock Transfer - Completed Buy & Sell Orders{% endblock %}

{% block STprofile_content %}

<!-- Filter Form -->
<form method="get" class="mb-4" style="display: flex; gap: 20px; align-items: end; flex-wrap: wrap;">
    <div>
        <label>From Date:</label>
        <input type="date" name="from_date" value="{{ from_date }}" class="form-control">
    </div>
    <div>
        <label>To Date:</label>
        <input type="date" name="to_date" value="{{ to_date }}" class="form-control">
    </div>
    <div>
        <label>Order ID:</label>
        <input type="text" name="order_id" value="{{ order_id }}" class="form-control" placeholder="Search Order ID">
    </div>
    <div>
        <button type="submit" class="btn btn-primary">Filter</button>
        <a href="{% url 'ST_User:ReportsST' %}" class="btn btn-secondary">Clear</a>
    </div>
</form>

    <!-- Completed Buy Orders -->
    <h4 class="mt-4 mb-2">✅ Completed Buy Orders</h4>
    <table class="STbuyorder-table mb-5">
        <thead>
            <tr>
                <th>Sl.no</th>
                <th>Order ID</th>
                <th>Date</th>
                <th>Time</th>
                <th>Accounts</th>
                <th>RM</th>
                <th>Customer Name</th>
                <th>Customer ID</th>
                <th>RM Status</th>
                <th>AM Status</th>
                <th>Status</th>
                <th>Stock Details</th>
            </tr>
        </thead>
        <tbody>
            {% for order in buy_orders_ReportsST %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ order.order_id }}</td>
                    <td>{{ order.timestamp|date:"d-m-Y" }}</td>
                    <td>{{ order.timestamp|time:"h:i A" }}</td>
                    <td>{{ order.AC_status|title }}</td>
                    <td>{{ order.get_RM_status_display }}</td>
                    <td>{{ order.user.profile.user.username }}</td>
                    <td>{{ order.user.profile.custom_user_id }}</td>
                    <td>{{ order.RM_status }}</td>
                    <td>{{ order.AC_status }}</td>
                    <td>{{ order.status }}</td>
                    <td><a class="STview" href="{% url 'ST_User:buyOrderSummaryST' order.order_id %}">View</a></td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="9">No completed buy orders found.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>


    <!-- Buy Order Pagination -->
    {% if buy_orders_ReportsST.has_other_pages %}
    <nav class="mb-5">
    <ul class="pagination">
        {% if buy_orders_ReportsST.has_previous %}
        <li class="page-item">
            <a class="page-link" href="?buy_page={{ buy_orders_ReportsST.previous_page_number }}&sell_page={{ sell_orders_ReportsST.number }}&from_date={{ from_date }}&to_date={{ to_date }}&order_id={{ order_id }}">«</a>
        </li>
        {% endif %}

        {% for num in buy_orders_ReportsST.paginator.page_range %}
        <li class="page-item {% if buy_orders_ReportsST.number == num %}active{% endif %}">
            <a class="page-link" href="?buy_page={{ num }}&sell_page={{ sell_orders_ReportsST.number }}&from_date={{ from_date }}&to_date={{ to_date }}&order_id={{ order_id }}">{{ num }}</a>
        </li>
        {% endfor %}

        {% if buy_orders_ReportsST.has_next %}
        <li class="page-item">
            <a class="page-link" href="?buy_page={{ buy_orders_ReportsST.next_page_number }}&sell_page={{ sell_orders_ReportsST.number }}&from_date={{ from_date }}&to_date={{ to_date }}&order_id={{ order_id }}">»</a>
        </li>
        {% endif %}
    </ul>
    </nav>
    {% endif %}


    <!-- Completed Sell Orders -->
    <h4 class="mt-4 mb-2">✅ Completed Sell Orders</h4>
    <table class="STbuyorder-table">
        <thead>
            <tr>
                <th>Sl.no</th>
                <th>Order ID</th>
                <th>Date</th>
                <th>Time</th>
                <th>Accounts</th>
                <th>RM</th>
                <th>Customer Name</th>
                <th>Customer ID</th>
                <th>RM Status</th>
                <th>AM Status</th>
                <th>Status</th>
                <th>Stock Details</th>
            </tr>
        </thead>
        <tbody>
            {% for order in sell_orders_ReportsST %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ order.order_id }}</td>
                    <td>{{ order.timestamp|date:"d-m-Y" }}</td>
                    <td>{{ order.timestamp|time:"h:i A" }}</td>
                    <td>{{ order.AC_status|title }}</td>
                    <td>{{ order.get_RM_status_display }}</td>
                    <td>{{ order.user.profile.user.username }}</td>
                    <td>{{ order.user.profile.custom_user_id }}</td>
                    <td>{{ order.RM_status }}</td>
                    <td>{{ order.AC_status }}</td>
                    <td>{{ order.status }}</td>
                    <td><a class="STview" href="{% url 'ST_User:SellerSummaryST' order.order_id %}">View</a></td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="9">No completed sell orders found.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Sell Order Pagination -->
    {% if sell_orders_ReportsST.has_other_pages %}
    <nav>
    <ul class="pagination">
        {% if sell_orders_ReportsST.has_previous %}
        <li class="page-item">
            <a class="page-link" href="?sell_page={{ sell_orders_ReportsST.previous_page_number }}&buy_page={{ buy_orders_ReportsST.number }}&from_date={{ from_date }}&to_date={{ to_date }}&order_id={{ order_id }}">«</a>
        </li>
        {% endif %}

        {% for num in sell_orders_ReportsST.paginator.page_range %}
        <li class="page-item {% if sell_orders_ReportsST.number == num %}active{% endif %}">
            <a class="page-link" href="?sell_page={{ num }}&buy_page={{ buy_orders_ReportsST.number }}&from_date={{ from_date }}&to_date={{ to_date }}&order_id={{ order_id }}">{{ num }}</a>
        </li>
        {% endfor %}

        {% if sell_orders_ReportsST.has_next %}
        <li class="page-item">
            <a class="page-link" href="?sell_page={{ sell_orders_ReportsST.next_page_number }}&buy_page={{ buy_orders_ReportsST.number }}&from_date={{ from_date }}&to_date={{ to_date }}&order_id={{ order_id }}">»</a>
        </li>
        {% endif %}
    </ul>
    </nav>
    {% endif %}

{% endblock %}
