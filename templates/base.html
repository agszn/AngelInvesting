{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Angel Investing Shares{% endblock %}</title>
    <link rel="icon" type="image/x-icon" href="{% static 'Media/images/headerlogo2.png' %}">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link rel="stylesheet" href="{% static 'css/style.css' %}"> -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" >
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Newsreader:opsz,wght@6..72,400;6..72,600;6..72,700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="{% static 'css/Style.css' %}" />
    <link rel="stylesheet" href="{% static 'css/header.css' %}" />
    <link rel="stylesheet" href="{% static 'css/Style_sidebar.css' %}" />
    {% block style %}
        <style>
            /* cointainer content block */
                /* .main_class {
                        width: 90%;
                        max-width: 1200px;
                        margin: 20px auto;
                        padding: 20px;
                        background-color: #f8f9fa;
                        border-radius: 10px;
                        box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
                    }   */

            .bold { font-weight: bold; }
            .italic { font-style: italic; }
            .underline { text-decoration: underline; }
            .bold_italic { font-weight: bold; font-style: italic; }
            .bold_underline { font-weight: bold; text-decoration: underline; }
            .italic_underline { font-style: italic; text-decoration: underline; }
            .all { font-weight: bold; font-style: italic; text-decoration: underline; }

          .up {
            color: #00FF33;
            font-weight: bold;
          }

          .down {
            color: red;
            font-weight: bold;
          }
          .yellow-profit {
            color: #FFD400;
          }


          /* whatsapp start part 1 */

          .rm-whatsapp-container {
              position: fixed;
              bottom: 20px;
              right: 20px;
              z-index: 9999;
            }

            .rm-contact-list {
              background: transparent;
              border-radius: 12px;
              margin-bottom: 10px;
              display: none;
              width: 260px;
              max-height: 300px;
              overflow-y: auto;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            }

            .rm-contact-card {
              background: #fff;
              cursor: pointer;
              border-left: 4px solid #25D366;
              border-bottom: 1px solid #eee;
              transition: background 0.2s;
              padding: 8px 10px;
              margin: 5px 5px 0 5px; /* Added spacing between cards and reduced right margin */
              border-radius: 8px;     /* Optional: rounded corners for nicer look */
              align-items: center;
            }

            .rm-contact-card:last-child {
              margin-bottom: 8px; /* Add spacing at the bottom */
            }

            .rm-contact-card:hover {
              background: #f8f9fa;
            }

            .rm-icon-wrapper {
              background-color: #25D366;
              width: 42px;
              height: 42px;
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
              margin-right: 24px; /* increased spacing between icon and text */
              flex-shrink: 0;
            }

            .rm-wa-icon {
              color: white;
              font-size: 20px;
            }

            .rm-text {
              display: flex;
              flex-direction: column;
              justify-content: center;
              white-space: nowrap;
              overflow: hidden;
              padding-left: 2px; /* optional: slight extra spacing */
            }

            .rm-text .rm-name {
              font-size: 15px;
              color: #000;
              line-height: 1.2;
            }

            .rm-text .rm-role {
              font-size: 12px;
              color: #666;
            }

            .rm-main-whatsapp-btn {
              background-color: #25D366;
              border: none;
              border-radius: 50%;
              width: 50px;
              height: 50px;
              color: white;
              font-size: 24px;
              box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            }
          /* whatsapp end part 1 */

        </style>
        <!-- whatsapp start part 1 -->
          <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

          <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
        <!-- whatsapp start part 2 -->
    {% endblock %}

</head>

<body>
    <div class="unlisted-landing-page">
      <div class="fixed-header-container">
        {% block marquee %}
        <!-- header marquee -->
          <div class="header-container-running">
            <!-- <div class="unlisted-deals">UnlistedDeals</div> -->
            <div class="stock-ticker">
              <marquee behavior="scroll" direction="left" scrollamount="10">
                {% for stock in marquee_stocks %}
                  {% if stock.percentage_diff is not None and not stock.hide_company_overview %}
                    <a href="{% url 'unlisted_stock_marketplace:stock_detail' stock.id %}" style="text-decoration: none;">
                    <span class="stock">
                      {{ stock.company_name|upper }}:
                      <span class="yellow-profit">₹{{ stock.share_price|floatformat:2 }}</span>
                      {% if stock.percentage_diff > 0 %}
                        <span class="up">▲ ({{ stock.percentage_diff|floatformat:2 }}%)</span>
                      {% elif stock.percentage_diff < 0 %}
                        <span class="down">▼ ({{ stock.percentage_diff|floatformat:2 }}%)</span>
                      {% else %}
                        <span>(0.00%)</span>
                      {% endif %}
                    </span></a>
                    &nbsp;&nbsp;&nbsp;
                  {% endif %}
                {% endfor %}
              </marquee>
            </div>
          </div>
        {% endblock %}
        <!--  base.html Navigation Bar - options   -->
        {% block contentNavbar %}
          {% include 'landing/navbar/navbar.html' %}  
        {% endblock %}
      </div>
        <main class="main_class" style="padding-top:121px;">
            {% block content %}

                <!-- base.html Banner changeable -->
                {% include 'landing/navbar/navDetail.html' %}

                <!-- base.html - Explore Unlisted Shares  -->
                {% include 'landing/index/index.html' %}

                <!-- base.html block content data -->
                {% include 'landing/index/index2.html' %}

                <!-- whatsApp start part 3  -->

                <div class="rm-whatsapp-container text-end">
                  <div class="rm-contact-list shadow rounded">

                    {% for rm in rms %}
                      <div class="rm-contact-card d-flex align-items-center p-2" onclick="sendWhatsApp('{{ rm.phone_number }}', 'Hi {{ rm.get_full_name|default:rm.username }}!')">
                        <div class="rm-icon-wrapper">
                          <i class="bi bi-person"></i>
                        </div>
                        <div class="rm-text">
                          <div class="rm-name fw-medium">{{ rm.get_full_name|default:rm.username }}</div>
                          <div class="rm-role text-muted small">Relationship Manager</div>
                        </div>
                      </div>
                    {% endfor %}

                  </div>

                  <button class="rm-main-whatsapp-btn" onclick="toggleRMList()">
                    <i class="bi bi-whatsapp"></i>
                  </button>
                </div>


                <script>
                  function sendWhatsApp(phone, message) {
                    const url = `https://wa.me/${phone.replace(/^\+/, '')}?text=${encodeURIComponent(message)}`;
                    window.open(url, '_blank');
                  }

                  function toggleRMList() {
                    const list = document.querySelector('.rm-contact-list');
                    list.style.display = list.style.display === 'block' ? 'none' : 'block';
                  }
                </script>


                <!-- whatsApp end part 3  -->
            {% endblock %}
                <!-- footer -->
            {% block footer %}
                {% include 'landing/footer/footer.html' %}
            {% endblock %}

            {% block stat %}
            {% endblock %}
        </main>

        
    </div>
  
  <!-- <script>
    const hamburger = document.querySelector('.hamburger');
    const navContainer = document.querySelector('.nav-container');

    hamburger.addEventListener('click', () => {
      hamburger.classList.toggle('active');
      navContainer.classList.toggle('active');
    });

    // Close menu when clicking on a link (optional)
    document.querySelectorAll('.nav-link').forEach(n => n.addEventListener('click', () => {
      hamburger.classList.remove('active');
      navContainer.classList.remove('active');
    }));
  </script> -->

  <!-- <script src="{% static 'js/bootstrap-4.6.0.min.js' %}"></script>
  <script src="{% static 'js/bootstrap.bundle-5.3.5.min.js' %}"></script> -->
  <script src="{% static 'js/jquery-3.6.0.min.js' %}"></script>

  <!-- jQuery first, then Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

{% load static %}

<!-- buy and sell -->

  {% include 'includes/universal_modals.html' %}

<!-- 
  <script>
  async function fetchAdvisorsBrokers() {
      const response = await fetch("{% url 'user_portfolio:load_advisors_brokers' %}");
      return await response.json();
  }

  async function openBuyModal(stockId, stockName, price, quantity, formAction) {
      document.getElementById('buy-stock-name').innerText = stockName;
      document.getElementById('buy-share-price').innerText = `₹${price}`;
      document.getElementById('buy-stock-id').value = stockId;
      document.getElementById('buy-price-per-share').value = price;
      document.getElementById('stock-quantity').value = quantity;
      document.getElementById('buy-form').action = formAction;

      const data = await fetchAdvisorsBrokers();
      populateSelect('buy-advisor', data.advisors, 'advisor_type');
      populateSelect('buy-broker', data.brokers, 'name');

      $('#universalBuyModal').modal('show');
  }

  async function openSellModal(stockId, stockName, price, quantity, formAction) {
      document.getElementById('sell-stock-name').innerText = stockName;
      document.getElementById('sell-stock-lot').innerText = `₹${price}`;
      document.getElementById('sell-stock-id').value = stockId;
      document.getElementById('sell-quantity').value = quantity;
      document.getElementById('sell-form').action = formAction;

      const data = await fetchAdvisorsBrokers();
      populateSelect('sell-advisor', data.advisors, 'advisor_type');
      populateSelect('sell-broker', data.brokers, 'name');

      $('#universalSellModal').modal('show');
  }

  function populateSelect(id, list, labelField) {
      const select = document.getElementById(id);
      select.innerHTML = '';
      list.forEach(item => {
          const option = document.createElement('option');
          option.value = item.id;
          option.textContent = item[labelField];
          select.appendChild(option);
      });
  }
  </script> -->


      <!-- Wishlist Confirmation Modal -->
      <div id="wishlistModal" class="wishlist-modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6);">
        <div class="wishlist-modal-content" style="background-color: #fff; margin: 10% auto; padding: 20px; border: 1px solid #888; width: 90%; max-width: 400px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); position: relative;">
          <span class="close" onclick="document.getElementById('wishlistModal').style.display='none'" style="position: absolute; top: 10px; right: 15px; font-size: 24px; font-weight: bold; color: #aaa; cursor: pointer;">&times;</span>
          <h3 style="margin-top: 0; font-size: 20px; color: #333;">Confirm Wishlist</h3>
          <p style="font-size: 16px; color: #555;">You're about to add <strong id="stockName" style="color: #000;"></strong> to <strong id="wishlistGroupName" style="color: #000;"></strong>.</p>
          <form id="wishlistForm" method="POST" action="{% url 'unlisted_stock_marketplace:add_to_wishlist' %}" style="margin-top: 20px;">
            {% csrf_token %}
            <input type="hidden" name="stock_id" id="stockIdInput">
            <input type="hidden" name="custom_list_name" id="customListName">
            <button type="submit" class="stock-btn yellow-btn" style="background-color: #61C46E; color: #000; border: none; padding: 10px 20px; font-size: 16px; cursor: pointer; border-radius: 5px; width: 100%;">Confirm Add</button>
          </form>
        </div>
      </div>



<!-- sell and buy script -->
<script>
  const isAuthenticated = {{ user.is_authenticated|yesno:"true,false" }};

  function redirectToLogin() {
      window.location.href = "{% url 'login' %}?next=" + window.location.pathname;
  }

  async function fetchAdvisorsBrokers() {
      try {
          const response = await fetch("{% url 'user_portfolio:load_advisors_brokers' %}");
          if (!response.ok) throw new Error("Failed to load advisors/brokers.");
          return await response.json();
      } catch (error) {
          console.error("Error fetching advisors/brokers:", error);
          alert("Failed to load advisor/broker data. Please try again.");
          return { advisors: [], brokers: [] };
      }
  }

  async function openBuyModal(stockId, stockName, price, quantity, formAction) {
      if (!isAuthenticated) {
          redirectToLogin();
          return;
      }

      document.getElementById('buy-stock-name').innerText = stockName;
      document.getElementById('buy-share-price').innerText = `₹${price}`;
      document.getElementById('buy-stock-id').value = stockId;
      document.getElementById('buy-price-per-share').value = price;
      document.getElementById('stock-quantity').value = quantity;
      document.getElementById('buy-form').action = formAction;

      const data = await fetchAdvisorsBrokers();
      populateSelect('buy-advisor', data.advisors, 'advisor_type');
      populateSelect('buy-broker', data.brokers, 'name');

      $('#universalBuyModal').modal('show');
  }

  async function openSellModal(stockId, stockName, price, quantity, formAction) {
      if (!isAuthenticated) {
          redirectToLogin();
          return;
      }

      document.getElementById('sell-stock-name').innerText = stockName;
      document.getElementById('sell-stock-lot').innerText = `₹${price}`;
      document.getElementById('sell-stock-id').value = stockId;
      document.getElementById('sell-quantity').value = quantity;
      document.getElementById('sell-form').action = formAction;

      const data = await fetchAdvisorsBrokers();
      populateSelect('sell-advisor', data.advisors, 'advisor_type');
      populateSelect('sell-broker', data.brokers, 'name');

      $('#universalSellModal').modal('show');
  }

  function populateSelect(id, list, labelField) {
      const select = document.getElementById(id);
      select.innerHTML = '';

      if (!list || list.length === 0) {
          const option = document.createElement('option');
          option.textContent = 'No options available';
          option.disabled = true;
          option.selected = true;
          select.appendChild(option);
          return;
      }

      list.forEach(item => {
          const option = document.createElement('option');
          option.value = item.id;
          option.textContent = item[labelField];
          select.appendChild(option);
      });
  }
</script>


<!-- wishlist start  -->
<script>
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }

  const csrftoken = getCookie('csrftoken');

  document.addEventListener("DOMContentLoaded", function () {
    const wishlistBtns = document.querySelectorAll(".wishlist-btn");
    const modal = document.getElementById("wishlistModal");
    const stockNameDisplay = document.getElementById("stockName");
    const wishlistGroupName = document.getElementById("wishlistGroupName");
    const stockIdInput = document.getElementById("stockIdInput");
    const customListName = document.getElementById("customListName");
    const closeBtn = document.querySelector(".wishlist-modal .close");

    wishlistBtns.forEach(btn => {
      btn.addEventListener("click", function (e) {
        e.preventDefault();

        if (!isAuthenticated) {
          redirectToLogin();
          return;
        }

        const stockId = this.dataset.stockId;
        const stockName = this.dataset.stockName;
        const fetchUrl = this.dataset.url + `?stock_id=${stockId}`;

        fetch(fetchUrl)
          .then(res => res.json())
          .then(data => {
            stockNameDisplay.textContent = stockName;
            stockIdInput.value = stockId;
            customListName.value = data.group_name;

            if (data.already_in) {
              wishlistGroupName.textContent = `${data.group_name} (Already Added)`;
              wishlistGroupName.style.color = 'red';
            } else {
              wishlistGroupName.textContent = data.group_name;
              wishlistGroupName.style.color = '#000';
            }

            modal.style.display = "block";
          })
          .catch(error => {
            alert("Failed to fetch group info.");
          });
      });
    });

    closeBtn.addEventListener("click", () => {
      modal.style.display = "none";
    });

    window.addEventListener("click", (e) => {
      if (e.target === modal) {
        modal.style.display = "none";
      }
    });
  });
</script>

<!-- wishlist end -->


<!-- testomonials scrolls -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
      const track = document.getElementById('carouselTrack');
      const cards = document.querySelectorAll('.testimonial-card');
      const cardCount = cards.length / 2;
      let currentPosition = 0;
      let cardWidth = cards[0].offsetWidth + 20;
      let animationId;
      let isHovering = false;
      let speed = 1;

      // Clone cards for infinite effect
      function initializeCarousel() {
        cardWidth = cards[0].offsetWidth + 20;
        track.style.width = `${cardWidth * cardCount * 2}px`;
      }

      function animate() {
        if (!isHovering) {
          currentPosition -= speed;

          // Reset position when we've scrolled all original cards
          if (currentPosition <= -cardWidth * cardCount) {
            currentPosition = 0;
          }

          track.style.transform = `translateX(${currentPosition}px)`;
        }

        animationId = requestAnimationFrame(animate);
      }

      // Pause on hover
      track.addEventListener('mouseenter', () => {
        isHovering = true;
      });

      track.addEventListener('mouseleave', () => {
        isHovering = false;
      });

      // Handle touch events for mobile
      track.addEventListener('touchstart', () => {
        isHovering = true;
      });

      track.addEventListener('touchend', () => {
        isHovering = false;
      });

      // Initialize and start animation
      window.addEventListener('resize', initializeCarousel);
      initializeCarousel();
      animate();

      // Clean up animation on exit
      window.addEventListener('beforeunload', () => {
        cancelAnimationFrame(animationId);
      });
    });
</script>

<!-- search auto suggest input box start -->
<!-- jQuery + jQuery UI for Autocomplete -->

<!-- part 1 start  -->
<!-- <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>

<script>
  $(function () {
    const searchSelectors = ['#searchInput', '.search-input', '#search-input'];  // <- added this line

    searchSelectors.forEach(function (selector) {
      const $el = $(selector);
      if ($el.length) {
        $el.autocomplete({
          source: "{% url 'stock_autocomplete' %}",
          minLength: 1,
          select: function (event, ui) {
            $el.val(ui.item.value);
            $el.closest('form').submit();
          }
        });
      }
    });
  });
</script> -->

<!-- part 1 end  -->


<!-- part 2 start -->

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const input = document.getElementById('search-input') || document.getElementById('searchInput');
    const stockCards = document.getElementById('stock-cards');
    const stockTableBody = document.getElementById('stock-table-body');
    const entriesSelect = document.getElementById('entries-select');

    if (!input) return;

    let debounceTimer;

    input.addEventListener('input', function () {
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(function () {
        const query = encodeURIComponent(input.value);
        const entries = entriesSelect ? `&entries=${encodeURIComponent(entriesSelect.value)}` : '';

        // Determine which view we're on
        let url = '';
        if (stockCards) {
          // We're on stock_list (cards)
          url = `{% url 'unlisted_stock_marketplace:stock_list' %}?q=${query}`;
        } else if (stockTableBody) {
          // We're on stock table view
          url = `{% url 'unlisted_stock_marketplace:StockListingTableFormat' %}?search=${query}${entries}`;
        } else {
          return;
        }

        fetch(url, {
          headers: {
            'X-Requested-With': 'XMLHttpRequest'
          }
        })
        .then(response => response.text())
        .then(html => {
          if (stockCards) {
            stockCards.innerHTML = html;
          } else if (stockTableBody) {
            stockTableBody.innerHTML = html;
          }
        });
      }, 300);
    });
  });
</script>


<!-- part 2 end -->

<!-- search auto suggest input box end -->



<!-- disable copy paste on website start -->
<!-- <script>
    document.addEventListener('DOMContentLoaded', function () {
        // Disable right-click
        document.addEventListener('contextmenu', function (e) {
            e.preventDefault();
        });

        // Disable Ctrl+C, Ctrl+X, Ctrl+U, Ctrl+S, Ctrl+I, Ctrl+Shift+I
        document.addEventListener('keydown', function (e) {
            if ((e.ctrlKey || e.metaKey) && 
                (e.key === 'c' || e.key === 'x' || e.key === 'u' || e.key === 's' || e.key === 'i')) {
                e.preventDefault();
            }

            // F12 key (Developer Tools)
            if (e.keyCode === 123) {
                e.preventDefault();
            }
        });
    });
</script> -->
<!-- disable copy paste on website end -->



<!-- custom model.py site manager start -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const fieldType = "{{ definition.field_type|escapejs }}";
        const valueFields = ["int", "dec", "char", "date"];

        valueFields.forEach(type => {
            const fields = document.querySelectorAll(`.${type}-field`);
            fields.forEach(el => {
                if (type === fieldType) {
                    el.style.display = "block";
                } else {
                    el.style.display = "none";
                }
            });
        });
    });
</script>
<!-- custom model.py site manager end -->
</body>


</html>
