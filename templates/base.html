{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Angel Investing Shares{% endblock %}</title>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link rel="stylesheet" href="{% static 'css/style.css' %}"> -->
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" >
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">

    <link rel="stylesheet" href="{% static 'Csss/Style.css' %}" />
    <link rel="stylesheet" href="{% static 'Csss/header.css' %}" />


    {% block style %}
        <style>
            /* cointainer content block */
                /* .main_class {
                        width: 90%;
                        max-width: 1200px;
                        margin: 20px auto;
                        padding: 20px;
                        background-color: #f8f9fa;
                        border-radius: 10px;
                        box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
                    }   */

            .bold { font-weight: bold; }
            .italic { font-style: italic; }
            .underline { text-decoration: underline; }
            .bold_italic { font-weight: bold; font-style: italic; }
            .bold_underline { font-weight: bold; text-decoration: underline; }
            .italic_underline { font-style: italic; text-decoration: underline; }
            .all { font-weight: bold; font-style: italic; text-decoration: underline; }

          .up {
            color: green;
            font-weight: bold;
          }

          .down {
            color: red;
            font-weight: bold;
          }
          .yellow-profit {
            color: #FFD400;
          }

        </style>
    {% endblock %}
</head>

<body>

    <div class="unlisted-landing-page">
      <div class="fixed-header-container">
        <!-- header marquee -->
        <div class="header-container-running">
          <div class="unlisted-deals">UnlistedDeals</div>
          <div class="stock-ticker">
            <marquee behavior="scroll" direction="left" scrollamount="10">
              {% for stock in marquee_stocks %}
                {% if stock.percentage_diff is not None %}
                  <span class="stock">
                    {{ stock.company_name|upper }}:
                     <span class="yellow-profit">₹{{ stock.share_price|floatformat:2 }}</span>
                    {% if stock.percentage_diff > 0 %}
                      <span class="up">▲ ({{ stock.percentage_diff|floatformat:2 }}%)</span>
                    {% elif stock.percentage_diff < 0 %}
                      <span class="down">▼ ({{ stock.percentage_diff|floatformat:2 }}%)</span>
                    {% else %}
                      <span>(0.00%)</span>
                    {% endif %}
                  </span>
                  &nbsp;&nbsp;&nbsp;
                {% endif %}
              {% endfor %}
            </marquee>
          </div>
        </div>



        <!--  base.html Navigation Bar - options   -->
        {% include 'landing/navbar/navbar.html' %}  
      </div>
        <main class="main_class" style="padding-top: 120px;">
            {% block content %}

                <!-- base.html Banner changeable -->
                {% include 'landing/navbar/navDetail.html' %}

                <!-- base.html - Explore Unlisted Shares  -->
                {% include 'landing/index/index.html' %}

                <!-- base.html block content data -->
                {% include 'landing/index/index2.html' %}

                <!-- footer -->
                {% include 'landing/footer/footer.html' %}
            {% endblock %}

            {% block stat %}
            {% endblock %}
        </main>

        
    </div>
  
  <!-- <script>
    const hamburger = document.querySelector('.hamburger');
    const navContainer = document.querySelector('.nav-container');

    hamburger.addEventListener('click', () => {
      hamburger.classList.toggle('active');
      navContainer.classList.toggle('active');
    });

    // Close menu when clicking on a link (optional)
    document.querySelectorAll('.nav-link').forEach(n => n.addEventListener('click', () => {
      hamburger.classList.remove('active');
      navContainer.classList.remove('active');
    }));
  </script> -->

  <!-- <script src="{% static 'js/bootstrap-4.6.0.min.js' %}"></script>
  <script src="{% static 'js/bootstrap.bundle-5.3.5.min.js' %}"></script> -->
  <script src="{% static 'js/jquery-3.6.0.min.js' %}"></script>

  <!-- jQuery first, then Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

{% load static %}

<!-- buy and sell -->

  {% include 'includes/universal_modals.html' %}

<!-- 
  <script>
  async function fetchAdvisorsBrokers() {
      const response = await fetch("{% url 'user_portfolio:load_advisors_brokers' %}");
      return await response.json();
  }

  async function openBuyModal(stockId, stockName, price, quantity, formAction) {
      document.getElementById('buy-stock-name').innerText = stockName;
      document.getElementById('buy-share-price').innerText = `₹${price}`;
      document.getElementById('buy-stock-id').value = stockId;
      document.getElementById('buy-price-per-share').value = price;
      document.getElementById('stock-quantity').value = quantity;
      document.getElementById('buy-form').action = formAction;

      const data = await fetchAdvisorsBrokers();
      populateSelect('buy-advisor', data.advisors, 'advisor_type');
      populateSelect('buy-broker', data.brokers, 'name');

      $('#universalBuyModal').modal('show');
  }

  async function openSellModal(stockId, stockName, price, quantity, formAction) {
      document.getElementById('sell-stock-name').innerText = stockName;
      document.getElementById('sell-stock-lot').innerText = `₹${price}`;
      document.getElementById('sell-stock-id').value = stockId;
      document.getElementById('sell-quantity').value = quantity;
      document.getElementById('sell-form').action = formAction;

      const data = await fetchAdvisorsBrokers();
      populateSelect('sell-advisor', data.advisors, 'advisor_type');
      populateSelect('sell-broker', data.brokers, 'name');

      $('#universalSellModal').modal('show');
  }

  function populateSelect(id, list, labelField) {
      const select = document.getElementById(id);
      select.innerHTML = '';
      list.forEach(item => {
          const option = document.createElement('option');
          option.value = item.id;
          option.textContent = item[labelField];
          select.appendChild(option);
      });
  }
  </script> -->


      <!-- Wishlist Confirmation Modal -->
      <div id="wishlistModal" class="wishlist-modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6);">
        <div class="wishlist-modal-content" style="background-color: #fff; margin: 10% auto; padding: 20px; border: 1px solid #888; width: 90%; max-width: 400px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); position: relative;">
          <span class="close" onclick="document.getElementById('wishlistModal').style.display='none'" style="position: absolute; top: 10px; right: 15px; font-size: 24px; font-weight: bold; color: #aaa; cursor: pointer;">&times;</span>
          <h3 style="margin-top: 0; font-size: 20px; color: #333;">Confirm Wishlist</h3>
          <p style="font-size: 16px; color: #555;">You're about to add <strong id="stockName" style="color: #000;"></strong> to <strong id="wishlistGroupName" style="color: #000;"></strong>.</p>
          <form id="wishlistForm" method="POST" action="{% url 'unlisted_stock_marketplace:add_to_wishlist' %}" style="margin-top: 20px;">
            {% csrf_token %}
            <input type="hidden" name="stock_id" id="stockIdInput">
            <input type="hidden" name="custom_list_name" id="customListName">
            <button type="submit" class="stock-btn yellow-btn" style="background-color: #f7c948; color: #000; border: none; padding: 10px 20px; font-size: 16px; cursor: pointer; border-radius: 5px; width: 100%;">Confirm Add</button>
          </form>
        </div>
      </div>



<!-- sell and buy script -->
<script>
  const isAuthenticated = {{ user.is_authenticated|yesno:"true,false" }};

  function redirectToLogin() {
      window.location.href = "{% url 'login' %}?next=" + window.location.pathname;
  }

  async function fetchAdvisorsBrokers() {
      try {
          const response = await fetch("{% url 'user_portfolio:load_advisors_brokers' %}");
          if (!response.ok) throw new Error("Failed to load advisors/brokers.");
          return await response.json();
      } catch (error) {
          console.error("Error fetching advisors/brokers:", error);
          alert("Failed to load advisor/broker data. Please try again.");
          return { advisors: [], brokers: [] };
      }
  }

  async function openBuyModal(stockId, stockName, price, quantity, formAction) {
      if (!isAuthenticated) {
          redirectToLogin();
          return;
      }

      document.getElementById('buy-stock-name').innerText = stockName;
      document.getElementById('buy-share-price').innerText = `₹${price}`;
      document.getElementById('buy-stock-id').value = stockId;
      document.getElementById('buy-price-per-share').value = price;
      document.getElementById('stock-quantity').value = quantity;
      document.getElementById('buy-form').action = formAction;

      const data = await fetchAdvisorsBrokers();
      populateSelect('buy-advisor', data.advisors, 'advisor_type');
      populateSelect('buy-broker', data.brokers, 'name');

      $('#universalBuyModal').modal('show');
  }

  async function openSellModal(stockId, stockName, price, quantity, formAction) {
      if (!isAuthenticated) {
          redirectToLogin();
          return;
      }

      document.getElementById('sell-stock-name').innerText = stockName;
      document.getElementById('sell-stock-lot').innerText = `₹${price}`;
      document.getElementById('sell-stock-id').value = stockId;
      document.getElementById('sell-quantity').value = quantity;
      document.getElementById('sell-form').action = formAction;

      const data = await fetchAdvisorsBrokers();
      populateSelect('sell-advisor', data.advisors, 'advisor_type');
      populateSelect('sell-broker', data.brokers, 'name');

      $('#universalSellModal').modal('show');
  }

  function populateSelect(id, list, labelField) {
      const select = document.getElementById(id);
      select.innerHTML = '';

      if (!list || list.length === 0) {
          const option = document.createElement('option');
          option.textContent = 'No options available';
          option.disabled = true;
          option.selected = true;
          select.appendChild(option);
          return;
      }

      list.forEach(item => {
          const option = document.createElement('option');
          option.value = item.id;
          option.textContent = item[labelField];
          select.appendChild(option);
      });
  }
</script>


<!-- wishlist start  -->
<script>
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
  const csrftoken = getCookie('csrftoken');

  document.addEventListener("DOMContentLoaded", function () {
    const wishlistBtns = document.querySelectorAll(".wishlist-btn");
    const modal = document.getElementById("wishlistModal");
    const stockNameDisplay = document.getElementById("stockName");
    const wishlistGroupName = document.getElementById("wishlistGroupName");
    const stockIdInput = document.getElementById("stockIdInput");
    const customListName = document.getElementById("customListName");
    const closeBtn = document.querySelector(".wishlist-modal .close");

    wishlistBtns.forEach(btn => {
      btn.addEventListener("click", function (e) {
        e.preventDefault();

        const stockId = this.dataset.stockId;
        const stockName = this.dataset.stockName;
        const fetchUrl = this.dataset.url + `?stock_id=${stockId}`;

        fetch(fetchUrl)
          .then(res => res.json())
          .then(data => {
            stockNameDisplay.textContent = stockName;
            stockIdInput.value = stockId;
            customListName.value = data.group_name;

            if (data.already_in) {
              wishlistGroupName.textContent = `${data.group_name} (Already Added)`;
              wishlistGroupName.style.color = 'red';
            } else {
              wishlistGroupName.textContent = data.group_name;
              wishlistGroupName.style.color = '#000';
            }

            modal.style.display = "block";
          })
          .catch(error => {
            alert("Failed to fetch group info.");
          });
      });
    });

    closeBtn.addEventListener("click", () => {
      modal.style.display = "none";
    });

    window.addEventListener("click", (e) => {
      if (e.target === modal) {
        modal.style.display = "none";
      }
    });
  });
</script>
<!-- wishlist end -->
</body>


</html>
