{% extends "admin/change_form.html" %}
{% load static %}

{% block after_related_objects %}
  {{ block.super }}

  <div class="inline-group">
    <h2>Preview: Custom Field Values</h2>
    {% if grouped_rows %}
      <table class="table" style="width:100%; border-collapse: collapse;" border="1">
        <thead>
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>Values (by TableHeader)</th>
          </tr>
        </thead>
        <tbody>
          {% for group_id, values in grouped_rows.items %}
            <tr>
              <td>{{ group_id }}</td>
              <td>{{ values.0.name }}</td>
              <td>
                {% for value in values %}
                  <b>{{ value.table_header.name }}:</b> {{ value.dec_value|default:"-" }}{% if not forloop.last %}, {% endif %}
                {% endfor %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>No entries added yet.</p>
    {% endif %}
  </div>
{% if show_bulk_entry %}
<div class="form-row">
  <h3>Bulk Paste Entry</h3>
  <form method="post" style="margin-bottom:20px;">
    {% csrf_token %}
    <textarea name="bulk_data" rows="10" class="vLargeTextField" style="width:100%; margin-bottom:10px;" placeholder="Paste parent-child rows here..."></textarea>
    
    <label for="start_header">Starting Table Header:</label>
    <select name="start_header" class="vSelect">
      {% for th in table_headers %}
        <option value="{{ forloop.counter0 }}">{{ th }}</option>
      {% endfor %}
    </select>

    <br><br>
    <input type="submit" value="Submit Bulk Data" class="button default">
  </form>
</div>
{% endif %}

{% endblock %}
