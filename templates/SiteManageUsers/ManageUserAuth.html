{% extends "baseStructureSM.html" %}
{% block title %}Users{% endblock %}
{% block subtitle %} Users {% endblock %}

{% block SMprofile_content %}
<div class="d-flex justify-content-between align-items-center my-3">
  <h2>Manage User Types</h2>
  <form method="get" class="d-flex" style="gap: 10px;">
    <input type="text" name="q" class="form-control" placeholder="Search by username or email" value="{{ query }}">
    <button type="submit" class="btn btn-secondary">Search</button>
  </form>
</div>

<div class="container">
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Username</th>
        <th>Email</th>
        <th>Current Type</th>
        <th>Change To</th>
        <th>Assign RM</th>
      </tr>
    </thead>
    <tbody>
      {% for user in users %}
      <tr>
        <td>{{ user.username }}</td>
        <td>{{ user.email }}</td>
        <td>{{ user.get_user_type_display }}</td>
        <td>
          <form method="post" class="d-flex gap-2 align-items-center">
            {% csrf_token %}
            <input type="hidden" name="user_id" value="{{ user.id }}">
            <select name="user_type" class="form-select">
              <option value="DF" {% if user.user_type == 'DF' %}selected{% endif %}>Default/User</option>
              <option value="RM" {% if user.user_type == 'RM' %}selected{% endif %}>Relationship Manager</option>
              <option value="AC" {% if user.user_type == 'AC' %}selected{% endif %}>Accounts</option>
              <option value="SM" {% if user.user_type == 'SM' %}selected{% endif %}>Site Manager</option>
              <option value="AP" {% if user.user_type == 'AP' %}selected{% endif %}>Associate Partner</option>
              <option value="PT" {% if user.user_type == 'PT' %}selected{% endif %}>Partner</option>
            </select>
        </td>
        <td>
            <select name="assigned_rm" class="form-select">
              <option value="">-- Select RM --</option>
              {% for rm in rms %}
              <option value="{{ rm.id }}" {% if user.assigned_rm and user.assigned_rm.id == rm.id %}selected{% endif %}>
                {{ rm.username }} ({{ rm.email }})
              </option>
              {% endfor %}
            </select>
        </td>
        <td>
            <button type="submit" class="btn btn-primary">Update</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
