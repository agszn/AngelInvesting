{% extends 'base.html' %}
{% load static %}
{% block title %}Stock Details{% endblock %}
{% load custom_filters %}
{% load custom_filter_overviewDetailedStock %}
{% block content %}
<link href="https://fonts.googleapis.com/css2?family=Newsreader:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
/* css Exactly */
    .stock-page-header-1 {
        display: flex;
        align-items: center;
        height: 312px;
        margin-bottom: 40px;
        background: radial-gradient(
            64.54% 23.63% at 69.24% 61.54%,
            #271b3f 0%,
            #271b3f 43.09%,
            #341a47 68.59%,
            #0e213f 100%
        );
        box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
    }
    .header-content-details {
        display: flex;
        justify-content: space-between;
        width: 100%;
        padding: 0 100px;
        color: #fff;
    }
    .header-details-left {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
        width: 220px;
        gap: 10px;
    }
    
    
    .header-details-logo-left{
        width: 200px;
        height: 100px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .company-logo-1 {
        width: 100%;
        height: 100%;
        object-fit: contain;
        border-radius: 10px;
    }
    .header-details-buttons
    {
        display: flex;
        width: 200px; 
        gap:10px;
    }
    .header-details-buttons a {
        flex: 1;
        text-align: center;
    }
    .header-details-whishlist{
        width: 200px;
        display: flex;
        justify-content: center;
    }
    .header-details-whishlist button {
        width: 100%;
        text-align: center;
    }
    .header-details-buttons a,
    .header-details-whishlist button {
        padding: 10px 20px;
        color: #fff;
        background-color: transparent;
        border: 2px solid yellow;
        border-radius: 5px;
        font-weight: 600;
        transition: all 0.3s ease;
        text-decoration: none;
    }

    .header-details-buttons a:hover,
    .header-details-whishlist button:hover {
        background-color: yellow;
        color: #000;
        transform: scale(1.05);
    }
    .header-details-right
    {
        background: linear-gradient(to right, #0a2342, #36144b); 
        padding: 20px; 
        border-radius: 10px; 
        color: white; 
        text-align: right;
    }
    .header-details-right h2 {
        font-size: 36px; 
        font-weight: bold; 
        margin-bottom: 10px;
        text-align: right;
    }

    .header-details-right p {
        margin: 6px 0;
        font-size: 20px;
        font-weight: bold;
        margin-bottom: 0;
    }

    .Sec2_3_PG_container {
        display: flex;
        gap: 10px;
        align-items: stretch;
        justify-content: space-between;
        flex-wrap: wrap;
        padding: 0 100px;
        width: 100%;
    }
    .Sec2_3_PG_box {
        display: flex;
        flex-direction: column;
        width: 49%;
    }
    .Sec2_3_PG_heading {
        font-size: 26px;
        font-weight: 700;
        margin-bottom: 18px;
        letter-spacing: 0.5px;
        color: #111;
        text-align: center;

    }
    .Sec2_3_PG_heading span {
        color: green;
        font-weight: 800;
    }

    .Sec2_3_PG_principlesBox {
        border: 1px solid #333;
        border-radius: 6px;
        padding: 20px;
        flex: 1;
        background: #fff;
        display: flex;
        flex-direction: column;
        color: #111;
        position: relative;
        z-index: 2;
        isolation: isolate;
    }
    .Sec2_3_PG_principlesRow {
        display: flex;
        justify-content: space-between;
        gap: 12px;
        padding: 8px 0;
        border-bottom: 1px dotted #ccc;
    }
    .Sec2_3_PG_principlesRow:last-child { border-bottom: none; }
    .Sec2_3_PG_col { width: 48%; min-width: 220px; }
    .Sec2_3_PG_label { font-size: 14px; color: #555 !important; display: block; line-height: 1.3; }
    .Sec2_3_PG_value { font-size: 16px; font-weight: bold; margin-top: 2px; color: #111 !important; line-height: 1.35; word-break: break-word; }


    .Sec2_3_PG_stockCard {
        background-color: #0d1b3d;
        border-radius: 12px;
        padding: 20px;
        flex: 1;
        position: relative;
        color: white;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        min-height: 360px;
        overflow: hidden;
    }
    .buttons { position: absolute; top: 20px; right: 20px; }
    .filter-btn {
        background: transparent;
        border: 1px solid yellow;
        color: yellow;
        padding: 4px 10px;
        margin-left: 5px;
        border-radius: 3px;
        font-size: 12px;
        cursor: pointer;
    }
    .filter-btn.active {
        background: yellow;
        color: #0d1b3d;
        font-weight: 600;
    }

    /* Chart area */
    .chart { width: 100%; flex: 1; margin-top: 60px; position: relative; min-height: 300px; }
    .chart canvas { width: 100% !important; height: 100% !important; }


    .cs-container {
        /* font-family: 'Newsreader', serif;
        font-size: 16px;
        line-height: 1.5; */
        margin: 40px 100px;
    }

    /* .cs-container h1,
    .cs-container h2,
    .cs-container h3,
    .cs-container h5,
    .cs-container p,
    .cs-container li,
    .cs-container small,
    .cs-container table,
    .cs-container th,
    .cs-container td,
    .cs-container button {
        font-family: 'Newsreader', serif;
        font-size: 16px;
        margin: 0;
        padding: 0;
        line-height: 1.5;
    } */

    .cs-top-center {
        display: flex;
        flex-direction: column;
        align-items: center;
        /* margin: 40px 100px 0 100px; */
        text-align: center;
    }
    .cs-heading {
        font-weight: bold;
        margin-bottom: 20px;
        font-size: 38px;
    }
    .cs-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        padding-bottom: 10px;
        justify-content: center;
    }

    .cs-buttons button {
        width: 150px;
        height: 50px;
        font-size: 16px;
        font-weight: 600;
        color: #fff;
        background-color: #0e213f;
        cursor: pointer;
        transition: 0.3s ease;
        border-radius: 5px;
        border: none;
        flex-shrink: 0;
    }

    .cs-buttons button:hover {
        transform: scale(1.05);
    }

    .cs-buttons button.cs-active {
        color: #00c853; /* Active tab text in green */
    }

    .cs-wrapper {
        display: flex;
        /* grid-template-columns: minmax(0, 5fr) minmax(0, 2fr); */
        /* gap: 20px; */
        /* margin: 20px 100px 40px 100px; */
        padding-top: 20px;
        width: 100%;
    }
    .cs-all-details 
    {
        /* display: flex; */
        /* flex-direction: column; */
        /* text-align: justify; */
        width: 75%;
    }
    .cs-left-inner {
        /* display: flex;
        flex-direction: column;
        gap: 20px; */
    }

    /* .cs-wrapper .cs-overview-section,
    .cs-wrapper .cs-content-section {
        margin: 20px 0;
    } */
    .cs-overview-section {
        display: block;
        /* margin: 20px 0; */
    }

    .cs-overview-box {
        padding-right:20px ;
    }

    .cs-overview-text h2 {
        font-size: 24px;
        font-weight: 600;
        margin: 10px 0;
    }

    .cs-overview-text h3 {
        font-size: 20px;
        font-weight: 600;
        margin: 10px 0;
    }

    .cs-overview-text p {
        font-size: 17px;
        font-weight: 400;
        padding-bottom: 10px;
        margin: 0;
    }

    .cs-overview-text p > span,
    .cs-overview-text ul li > span {
        font-weight: 700;
        color: #000;
    }

    .cs-overview-text ul {
        margin: 0;
        padding-left: 20px;
    }

    .cs-overview-text ul li {
        font-size: 17px;
        font-weight: 400;
        padding-bottom: 10px;
        margin: 0;
    }

    .cs-overview-text table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }

    .cs-overview-text table,
    .cs-overview-text table th,
    .cs-overview-text table td {
        border: 1px solid #000;
        padding: 8px;
        text-align: left;
    }

    .cs-overview-text table th:nth-child(2),
    .cs-overview-text table td:nth-child(2),
    .cs-overview-text table th:nth-child(3),
    .cs-overview-text table td:nth-child(3) {
        text-align: right;
    }

    .cs-overview-text table tr:last-child td {
        font-weight: 600;
    }

    .cs-right-sidebar {
        background: #0e213f;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 10px;
        font-size: 14px;
        height: fit-content;
        color: white;
        /* margin-top: 40px; */
        width: 25%;
    }
    /* .list-group-item
    {
        font-size: 16px;
    } */

    @media (min-width: 1025px) {
        .cs-right-sidebar {
        position: sticky;
        top: 190px;
        }
    }

    @media (min-width: 320px) and (max-width: 767px) 
    {
        .stock-page-header-1 {
            flex-direction: column;
            height: auto;
            padding: 20px;
            margin-bottom: 0;
        }

        .header-content-details {
            flex-direction: column;
            padding: 0 20px;
            gap: 20px;
        }

        .header-details-left {
            width: 100%;
            align-items: center;
        }

        .header-details-logo-left {
            width: 100%;
            height: auto;
        }

        .header-details-buttons {
            flex-direction: column;
            width: 100%;
            gap: 10px;
        }

        .header-details-whishlist {
            width: 100%;
        }

        .header-details-whishlist button,
        .header-details-buttons a {
            width: 100%;
        }

        .header-details-right {
            text-align: center;
            padding: 10px; 
        }
        .header-details-right h2 {
            font-size: 28px;
            margin-bottom: 10px;
            text-align: center;
        }

        .header-details-right p {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 0;
        }

        .Sec2_3_PG_container
        {
            display: block;
            gap: 10px;
            align-items: stretch;
            justify-content: space-between;
            flex-wrap: wrap;
            padding: 0 10px;
            width: 100%;
        }
        .Sec2_3_PG_box
        {
            width: 98%;
        }
        .Sec2_3_PG_heading
        {
            margin-top: 20px;
        }
        .Sec2_3_PG_principlesRow {
            flex-direction: column; /* Stack the two columns */
            gap: 8px;
        }

        .Sec2_3_PG_col {
            width: 100% !important; /* Full width for mobile */
        }

        .Sec2_3_PG_label,
        .Sec2_3_PG_value {
            font-size: 14px;
            line-height: 1.4;
            word-break: break-word; /* Break long text */
            overflow-wrap: break-word;
            white-space: normal; /* Allow wrapping */
            display: block;
        }
        .cs-top-center {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px 10px 0 10px;
            text-align: center;
        }
        .cs-heading {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 30px;
        }
        .cs-buttons {
            gap: 5px;
        }

        .cs-container
        {
            margin: 20px 10px 20px 10px;
        }

        .cs-wrapper 
        {
            display: block;
            /* gap: 10px; */
            /* margin: 20px; */
            padding: 10px;
            width: 100%;
        }
        .cs-all-details 
        {
            width: 100%;
        }
        .cs-overview-box {
            padding-bottom:20px ;
        }
        .cs-right-sidebar {
            background: #0e213f;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            font-size: 14px;
            height: fit-content;
            color: white;
            /* margin-top: 40px; */
            width: 98%;
        }
    }

    /* End */
    .stock-table {
        width: 100%;
        border-collapse: collapse;
    }

    .stock-table th, .stock-table td {
        border: 1px solid #ddd;
        padding: 12px;
        text-align: left;
    }

    .stock-table th {
        background: #343a40;
        color: white;
    }

    .stock-table tr:nth-child(even) {
        background: #f2f2f2;
    }
    
    .styled-card {
      border: 2px solid yellow;
      padding: px;
      text-align: center;
      width: 250px;
      border-radius: 10px;
      background-color: transparent;
    }

    .stock-btn.yellow-btn {
      flex: 1;
      margin: 0 5px;
      padding: 10px;
      background-color: transparent;
      color: white;
      border: 2px solid yellow;
      border-radius: 5px;
      font-weight: bold;
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }

    /* Arrow styles */
    .nav-arrow {
        cursor: pointer;
        z-index: 2;
    }

    @media screen and (max-width: 1200px) {
        .nav-arrow {
        width: 35px;
        height: 35px;
        }

        .nav-arrow.left {
        left: -35px;
        }

        .nav-arrow.right {
        right: -35px;
        }
    }

    @media screen and (max-width: 992px) {
        .nav-arrow {
        width: 30px;
        height: 30px;
        }

        .nav-arrow.left {
        left: -30px;
        }

        .nav-arrow.right {
        right: -30px;
        }
    }

    @media screen and (max-width: 768px) {
        .nav-arrow {
        width: 26px;
        height: 26px;
        }

        .nav-arrow.left {
        left: -20px;
        }

        .nav-arrow.right {
        right: -20px;
        }
    }

    @media screen and (max-width: 480px) {
        .nav-arrow {
        width: 22px;
        height: 22px;
        }

        .nav-arrow.left {
        left: -10px;
        }

        .nav-arrow.right {
        right: -10px;
        }
    }

    
</style>
<!-- part 1 start -->
<div class="stock-page-header-1">
    <div class="header-content-details">
        <!-- stock data buy sell wishlist left options start -->
        <div class="header-details-left">
            <div class="header-details-logo-left">
                {% if stock.logo %}
                    <img src="{{ stock.logo.url }}" alt="{{ stock.company_name }} Logo" class="company-logo-1">
                {% endif %}
            </div>
            <div class="header-details-buttons">
                <a href="javascript:void(0);"
                    onclick='openBuyModal(
                                "{{ stock.id }}",
                                "{{ stock.company_name|escapejs }}",
                                "{{ stock.share_price }}",
                                "{{ stock.quantity }}",
                                "{% url 'user_portfolio:buy_stock' stock.id %}"
                            )'
                >Buy</a>
                <a href="javascript:void(0);"
                    onclick='openSellModal(
                        "{{ stock.id }}",
                        "{{ stock.company_name|escapejs }}",
                        "{{ stock.share_price }}",
                        "{{ stock.quantity }}",
                        "{% url 'user_portfolio:sell_stock' stock.id %}"
                    )'
                >Sell</a>
                </div>
                <div class="header-details-whishlist">
                <!-- <button
                    data-stock-id="{{ stock.id }}" 
                    data-stock-name="{{ stock.company_name }}" 
                    data-url="{% url 'unlisted_stock_marketplace:get_next_wishlist_group_name' %}" 
                >Wishlist üõí</button> -->



                <button 
                    class="stock-btn yellow-btn wishlist-btn wishlist" 
                    data-stock-id="{{ stock.id }}" 
                    data-stock-name="{{ stock.company_name }}" 
                    data-url="{% url 'unlisted_stock_marketplace:get_next_wishlist_group_name' %}" 
                    style="width: 100%; margin:0;">
                    Wishlist
                </button>
            </div>
        </div>
            <!-- stock data buy sell wishlist left options end -->
            <!-- stock data price LEP left options start -->


            <!-- <div class="header-details-right">
            <h2>{{ stock.company_name }}</h2>
            <p><strong>Price:</strong> ‚Çπ{{ stock.share_price }}</p>
            <p><strong>Last Entry Price:</strong> ‚Çπ{{ stock.ltp }}</p>
            {% if stock.profit > 0 %}
                <p>
                <strong>Profit/Loss:</strong>
                <span style="color: green;">&#9650; ‚Çπ{{ stock.profit|floatformat:2 }} ({{ stock.profit_percentage|floatformat:2 }}%)</span>
                </p>
                {% elif stock.profit < 0 %}
                <p>
                    <strong>Profit/Loss:</strong>
                    <span style="color: red;">&#9660; ‚Çπ{{ stock.profit|floatformat:2 }} ({{ stock.profit_percentage|floatformat:2 }}%)</span>
                </p>
                {% else %}
                <p>
                    <strong>Profit/Loss:</strong>
                    <span style="color: white;">‚Çπ0.00 (0.00%)</span>
                </p>
                {% endif %}

            </div> -->


        <div class="header-details-right">
            <h2>
                {{ stock.company_name }} 
            </h2>
            <p style="color: gold;">
                Last Traded Price
            </p>
            <p style="font-size: 32px; margin: 5px 0;">
                ‚Çπ{{ stock.share_price|floatformat:2 }}
                {% if stock.profit > 0 %}
                <span style="color: #00ff00; font-weight: bold;">
                    ( + {{ stock.profit_percentage|floatformat:2 }} % )
                </span>
                <span style="font-size: 24px;">‚≠ê ‚≠ê</span>
                {% elif stock.profit < 0 %}
                <span style="color: #ff4c4c; font-weight: bold;">
                    ( {{ stock.profit_percentage|floatformat:2 }} % )
                </span>
                <span style="font-size: 24px;">üîª</span>
                    {% else %}
                    <span style="color: #ffffff;">
                        ( 0.00 % )
                    </span>
                    {% endif %}
            </p>
        </div>
        <!-- stock data price LEP left options end -->
    </div>
</div>
<!-- part 1 end -->

<!-- principles and graph section 2 and 3 start -->
<section class="Sec2_3_PG_container">
    <!-- LEFT: Principles -->
    <div class="Sec2_3_PG_box">
        <h2 class="Sec2_3_PG_heading">Principles</h2>
        <div class="Sec2_3_PG_principlesBox" style="color: #000;">
            <div class="Sec2_3_PG_principlesRow">
                <div class="Sec2_3_PG_col">
                    <span class="Sec2_3_PG_label">Company Name</span>
                    <span class="Sec2_3_PG_value">{{ stock.company_name }}</span>
                </div>
                <div class="Sec2_3_PG_col">
                    <!-- <span class="Sec2_3_PG_label">Market Capitalization (in Cr)</span> -->
                    <span class="Sec2_3_PG_label">Market Cap</span>
                    <span class="Sec2_3_PG_value">‚Çπ {{ stock.market_capitalization }}</span>
                </div>
            </div>
            <div class="Sec2_3_PG_principlesRow">
                <div class="Sec2_3_PG_col">
                    <span class="Sec2_3_PG_label">ISIN No.</span>
                    <span class="Sec2_3_PG_value">{{ stock.isin_no }}</span>
                </div>
                <div class="Sec2_3_PG_col">
                    <span class="Sec2_3_PG_label">No. of Outstanding Shares</span>
                    <span class="Sec2_3_PG_value">{{ stock.outstanding_shares }}</span>
                </div>
            </div>
            <div class="Sec2_3_PG_principlesRow">
                <div class="Sec2_3_PG_col">
                    <span class="Sec2_3_PG_label">PAN No.</span>
                    <span class="Sec2_3_PG_value">{{ stock.pan_no }}</span>
                </div>
                <div class="Sec2_3_PG_col">
                    <span class="Sec2_3_PG_label">PE ratio</span>
                    <span class="Sec2_3_PG_value">{{ stock.pe_ratio }}</span>
                </div>
            </div>
            <div class="Sec2_3_PG_principlesRow">
                <div class="Sec2_3_PG_col">
                    <span class="Sec2_3_PG_label">CIN</span>
                    <span class="Sec2_3_PG_value">{{ stock.cin }}</span>
                </div>
                <div class="Sec2_3_PG_col">
                    <span class="Sec2_3_PG_label">Book value</span>
                    <span class="Sec2_3_PG_value">‚Çπ {{ stock.book_value }}</span>
                </div>
            </div>
            <div class="Sec2_3_PG_principlesRow">
                <div class="Sec2_3_PG_col">
                    <span class="Sec2_3_PG_label">Sector</span>
                    <span class="Sec2_3_PG_value">{{ stock.sector }}</span>
                </div>
                <div class="Sec2_3_PG_col">
                    <span class="Sec2_3_PG_label">P/BV</span>
                    <span class="Sec2_3_PG_value">{{ stock.pbv }}</span>
                </div>
            </div>
            <div class="Sec2_3_PG_principlesRow">
                <div class="Sec2_3_PG_col">
                    <span class="Sec2_3_PG_label">DRHP Filed?</span>
                    <span class="Sec2_3_PG_value">{% if stock.drhp_filed %}Yes{% else %}No{% endif %}</span>
                </div>
                <div class="Sec2_3_PG_col">
                    <span class="Sec2_3_PG_label">P/S Ratio</span>
                    <span class="Sec2_3_PG_value">{{ stock.ps_ratio }}</span>
                </div>
            </div>
            <div class="Sec2_3_PG_principlesRow">
                <div class="Sec2_3_PG_col">
                    <span class="Sec2_3_PG_label">Available on</span>
                    <span class="Sec2_3_PG_value">{{ stock.available_on }}</span>
                </div>
                <div class="Sec2_3_PG_col">
                    <span class="Sec2_3_PG_label">EPS</span>
                    <span class="Sec2_3_PG_value">‚Çπ {{ stock.eps }}</span>
                </div>
            </div>
            <div class="Sec2_3_PG_principlesRow">
                <div class="Sec2_3_PG_col">
                    <span class="Sec2_3_PG_label">Registration Date</span>
                    <span class="Sec2_3_PG_value">{{ stock.registration_date }}</span>
                </div>
                <div class="Sec2_3_PG_col">
                    <span class="Sec2_3_PG_label">Face Value</span>
                    <span class="Sec2_3_PG_value">‚Çπ {{ stock.face_value }}</span>
                </div>
            </div>
        </div>
    </div>
    <!-- RIGHT: Stock Performance -->
    <div class="Sec2_3_PG_box">
        <h2 class="Sec2_3_PG_heading">Stock <span>Performance</span></h2>
        <div class="Sec2_3_PG_stockCard">
            <div class="buttons">
                <!-- <button class="filter-btn" data-range="7">1W</button> -->
                <button class="filter-btn" data-range="30">1M</button>
                <button class="filter-btn" data-range="90">3M</button>
                <button class="filter-btn active" data-range="180">6M</button>
                <button class="filter-btn" data-range="365">1Y</button>
                <!-- <button class="filter-btn" data-range="730">2Y</button> -->
                <!-- <button class="filter-btn" data-range="1095">3Y</button> -->
                <!-- <button class="filter-btn" data-range="1825">5Y</button> -->
                <button class="filter-btn" data-range="MAX">MAX</button>
            </div>
            <div class="chart">
                <canvas id="stockPriceChart"></canvas>
            </div>
        </div>
    </div>
</section>
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const stockDates = JSON.parse('{{ stock_dates|safe }}');
    const stockPrices = JSON.parse('{{ stock_prices|safe }}').map(Number);
    const parsedDates = stockDates.map(d => new Date(d));

    const ctx = document.getElementById('stockPriceChart').getContext('2d');

    // ---------- Helpers anchored to LAST DATA POINT ----------
    const lastIdx = Math.max(0, parsedDates.length - 1);
    const anchorEnd = new Date(parsedDates[lastIdx]); // latest data point (end)

    // Keep same day-of-month when adding/subtracting months; clamp to month-end when needed
    function addMonthsSameDay(date, delta) {
      const d = new Date(date);
      const y = d.getFullYear();
      const m = d.getMonth();
      const day = d.getDate();
      // go to the 1st of target month, then clamp day
      const target = new Date(y, m + delta, 1);
      const maxDay = new Date(target.getFullYear(), target.getMonth() + 1, 0).getDate();
      target.setDate(Math.min(day, maxDay));
      target.setHours(0, 0, 0, 0);
      return target;
    }

    // Monday helpers: previous Monday (<= date) and next Monday (> date)
    function prevMonday(d) {
      const date = new Date(d);
      const day = date.getDay(); // 0=Sun, 1=Mon, ... 6=Sat
      const diff = (day + 6) % 7; // days since Monday
      date.setDate(date.getDate() - diff);
      date.setHours(0, 0, 0, 0);
      return date;
    }
    function nextMonday(d) {
      const date = new Date(d);
      const day = date.getDay();
      const add = (8 - day) % 7 || 7; // at least +1..+7 to get strictly next Monday
      date.setDate(date.getDate() + add);
      date.setHours(23, 59, 59, 999);
      return date;
    }

    // Filter in [start, end] inclusive
    function filterBetween(start, end) {
      const labels = [], data = [];
      for (let i = 0; i < parsedDates.length; i++) {
        const t = parsedDates[i];
        if (t >= start && t <= end) {
          labels.push(t);
          data.push(stockPrices[i]);
        }
      }
      return { labels, data, min: start, max: end };
    }

    function filterRangeByMonthsEndingAtAnchor(monthCount, { snapWeeks = false } = {}) {
      const end = new Date(anchorEnd);
      end.setHours(23, 59, 59, 999);

      const startAnchor = addMonthsSameDay(anchorEnd, -monthCount); // same day-of-month back
      let start = new Date(startAnchor);
      let max = new Date(end);

      // For 1M, snap to full Monday‚ÜíMonday windows for clean weekly ticks
      if (snapWeeks) {
        start = prevMonday(startAnchor);
        max = nextMonday(anchorEnd);
      }

      return filterBetween(start, max);
    }

    function filterData(rangeAttr) {
      if (rangeAttr === "MAX") {
        const start = new Date(parsedDates[0]); start.setHours(0, 0, 0, 0);
        const end = new Date(anchorEnd); end.setHours(23, 59, 59, 999);
        return filterBetween(start, end);
      }
      const map = { "30": 1, "90": 3, "180": 6, "365": 12 };
      const months = map[String(rangeAttr)] ?? 6;
      const snapWeeks = rangeAttr === "30"; // only 1M snaps Monday‚ÜíMonday
      return filterRangeByMonthsEndingAtAnchor(months, { snapWeeks });
    }

    // ---------- Scales ----------
    function scaleOptions(rangeAttr) {
      if (rangeAttr === "30") {
        // 1M ‚Üí weekly ticks (we've snapped min/max to Monday‚ÜíMonday)
        return {
          x: {
            type: 'time',
            bounds: 'ticks',
            offset: false,
            time: {
              unit: 'week',
              stepSize: 1,
              displayFormats: { week: 'dd MMM' },
              tooltipFormat: 'MMM dd, yyyy'
            },
            ticks: {
              color: 'white',
              autoSkip: false,
              maxRotation: 45,
              minRotation: 45
            },
            grid: { color: 'rgba(255,255,255,0.15)' }
          },
          y: {
            ticks: { color: 'white' },
            grid: { color: 'rgba(255,255,255,0.15)' }
          }
        };
      }

      // Other ranges ‚Üí monthly ticks
      return {
        x: {
          type: 'time',
          bounds: 'ticks',
          offset: false,
          time: {
            unit: 'month',
            stepSize: 1,
            displayFormats: { month: 'MMM yyyy' },
            tooltipFormat: 'MMM dd, yyyy'
          },
          ticks: {
            color: 'white',
            autoSkip: false,
            maxRotation: 45,
            minRotation: 45
          },
          grid: { color: 'rgba(255,255,255,0.15)' }
        },
        y: {
          ticks: { color: 'white' },
          grid: { color: 'rgba(255,255,255,0.15)' }
        }
      };
    }

    // ---------- Build chart (default 6M) ----------
    const defaultRange = "180";
    const initial = filterData(defaultRange);

    let stockChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: initial.labels,
        datasets: [{
          label: 'Stock Price',
          data: initial.data,
          borderColor: 'yellow',
          backgroundColor: 'rgba(255, 255, 0, 0.2)',
          borderWidth: 2,
          pointRadius: 3,
          pointBackgroundColor: 'yellow',
          tension: 0.3
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: { mode: 'index', intersect: false },
        scales: scaleOptions(defaultRange),
        plugins: {
          legend: { labels: { color: 'white' } },
          tooltip: { mode: 'index', intersect: false }
        }
      }
    });

    stockChart.options.scales.x.min = initial.min;
    stockChart.options.scales.x.max = initial.max;
    stockChart.update();

    // ---------- Range buttons ----------
    document.querySelectorAll(".filter-btn").forEach(btn => {
      btn.addEventListener("click", function () {
        const range = this.getAttribute("data-range");
        const { labels, data, min, max } = filterData(range);

        stockChart.options.scales = scaleOptions(range);
        stockChart.data.labels = labels;
        stockChart.data.datasets[0].data = data;
        stockChart.options.scales.x.min = min;
        stockChart.options.scales.x.max = max;

        stockChart.update();

        document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
        this.classList.add("active");
      });
    });
  });
</script>
<!-- principles and graph section 2 and 3 end -->
<!-- Google Font -->

<style>
  /* @media (max-width: 1024px) {
    .cs-wrapper {
      grid-template-columns: 1fr;
    }
  } */

  /* Top center header */
  /* Tabs (buttons) */

  /* Table styling */
  .cs-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 15px;
    min-width: 600px;
  }

  .cs-table th,
  .cs-table td {
    border: 1px solid #ddd;
    padding: 6px;
  }

  .cs-table th {
    background: #f2f2f2;
    font-weight: 600;
  }

  .cs-table td {
    text-align: right;
  }

  .cs-table td:first-child,
  .cs-table th:first-child {
    text-align: left;
    position: sticky;
    left: 0;
    background: #fff;
    z-index: 1;
  }

  .cs-table tr:last-child td {
    font-weight: 600;
  }

  /* Overview styling */
</style>

<div class="cs-container">
    <!-- Top Centered Header + Buttons -->
    <div class="cs-top-center">
        <h1 class="cs-heading">Company <span class="highlight">Details</span></h1>
        <div class="cs-buttons">
            <button type="button" onclick="csShowSection('overview')" class="cs-active">Overview</button>
            <button type="button" onclick="csShowSection('balance-sheet')">Balance Sheet</button>
            <button type="button" onclick="csShowSection('pl-account')">P&L Account</button>
            <button type="button" onclick="csShowSection('cash-flow')">Cash Flow</button>
            <button type="button" onclick="csShowSection('dividend-history')">Dividend</button>
            <button type="button" onclick="csShowSection('financial-ratios')">Financial Ratios</button>
        </div>
    </div>

    <section class="cs-wrapper">
        <!-- Left (80%) -->
        <section class="cs-all-details">
            <div class="cs-left-inner">
                <!-- Overview -->
                <section id="overview" class="cs-overview-section">
                    <section class="cs-overview-box">
                        <div class="cs-overview-text">
                            {{ stock.company_overview|safe }}
                        </div>
                        {% if reports %}
                        <div class="cs-overview-text">
                            {% for report in reports %}
                                {{ report.summary|safe }}
                            {% endfor %}
                        </div>
                        {% endif %}
                    </section>
                </section>
                <!-- Balance Sheet -->
        <section id="balance-sheet" class="cs-content-section" style="display: none;">
          <h2>{{ stock.company_name }} - Balance Sheet</h2>
          {% with data=balance_sheet_data %}
            {% if data.headers and data.rows %}
              <div style="overflow-x:auto; width:100%;">
                <table class="cs-table">
                  <thead>
                    <tr>
                      <th>{{ data.particulars_header.title }}</th>
                      {% for header in data.headers %}
                        <th>{{ header.title }} (‚Çπ Cr)</th>
                      {% endfor %}
                    </tr>
                  </thead>
                  <tbody>
                    {% for row in data.rows %}
                      <tr {% if row.text_style in "bold bold_italic bold_underline all" %}style="font-weight:bold;"{% endif %}>
                        <td class="{{ row.text_style|default:'normal' }}">{{ row.name }}</td>
                        {% for header in data.headers %}
                          <td>{{ row.values|get_itemTest:header.id|default:"" }}</td>
                        {% endfor %}
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            {% else %}
              <p style="text-align:center; color:#666;">No data available.</p>
            {% endif %}
          {% endwith %}
        </section>

        <!-- P&L Account -->
        <section id="pl-account" class="cs-content-section" style="display: none;">
          <h2>{{ stock.company_name }} - P & L Account</h2>
          {% with data=pl_account_data %}
            {% if data.headers and data.rows %}
              <div style="overflow-x:auto; width:100%;">
                <table class="cs-table">
                  <thead>
                    <tr>
                      <th>{{ data.particulars_header.title }}</th>
                      {% for header in data.headers %}
                        <th>{{ header.title }} (‚Çπ Cr)</th>
                      {% endfor %}
                    </tr>
                  </thead>
                  <tbody>
                    {% for row in data.rows %}
                      <tr {% if row.text_style in "bold bold_italic bold_underline all" %}style="font-weight:bold;"{% endif %}>
                        <td class="{{ row.text_style|default:'normal' }}">{{ row.name }}</td>
                        {% for header in data.headers %}
                          <td>{{ row.values|get_itemTest:header.id|default:"" }}</td>
                        {% endfor %}
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            {% else %}
              <p style="text-align:center; color:#666;">No data available.</p>
            {% endif %}
          {% endwith %}
        </section>

        <!-- Cash Flow -->
        <section id="cash-flow" class="cs-content-section" style="display: none;">
          <h2>{{ stock.company_name }} - Cash Flow</h2>
          {% with data=cash_flow_data %}
            {% if data.headers and data.rows %}
              <div style="overflow-x:auto; width:100%;">
                <table class="cs-table">
                  <thead>
                    <tr>
                      <th>{{ data.particulars_header.title }}</th>
                      {% for header in data.headers %}
                        <th>{{ header.title }} (‚Çπ Cr)</th>
                      {% endfor %}
                    </tr>
                  </thead>
                  <tbody>
                    {% for row in data.rows %}
                      <tr {% if row.text_style in "bold bold_italic bold_underline all" %}style="font-weight:bold;"{% endif %}>
                        <td class="{{ row.text_style|default:'normal' }}">{{ row.name }}</td>
                        {% for header in data.headers %}
                          <td>{{ row.values|get_itemTest:header.id|default:"" }}</td>
                        {% endfor %}
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            {% else %}
              <p style="text-align:center; color:#666;">No data available.</p>
            {% endif %}
          {% endwith %}
        </section>

        <!-- Dividend History -->
        <section id="dividend-history" class="cs-content-section" style="display: none;">
          <h2>{{ stock.company_name }} - Dividend History</h2>
          {% with data=dividend_data %}
            {% if data.headers and data.rows %}
              <div style="overflow-x:auto; width:100%;">
                <table class="cs-table">
                  <thead>
                    <tr>
                      <th>{{ data.particulars_header.title }}</th>
                      {% for header in data.headers %}
                        <th>{{ header.title }} (‚Çπ Cr)</th>
                      {% endfor %}
                    </tr>
                  </thead>
                  <tbody>
                    {% for row in data.rows %}
                      <tr {% if row.text_style in "bold bold_italic bold_underline all" %}style="font-weight:bold;"{% endif %}>
                        <td class="{{ row.text_style|default:'normal' }}">{{ row.name }}</td>
                        {% for header in data.headers %}
                          <td>{{ row.values|get_itemTest:header.id|default:"" }}</td>
                        {% endfor %}
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            {% else %}
              <p style="text-align:center; color:#666;">No data available.</p>
            {% endif %}
          {% endwith %}
        </section>

        <!-- Financial Ratios -->
        <section id="financial-ratios" class="cs-content-section" style="display: none;">
          <h2>{{ stock.company_name }} - Financial Ratios</h2>
          {% with data=financial_ratios_data %}
            {% if data.headers and data.rows %}
              <div style="overflow:auto; max-height:500px; width:100%;">
                <table class="cs-table">
                  <thead>
                    <tr>
                      <th>{{ data.particulars_header.title }}</th>
                      {% for header in data.headers %}
                        <th>{{ header.title }} (‚Çπ Cr)</th>
                      {% endfor %}
                    </tr>
                  </thead>
                  <tbody>
                    {% for row in data.rows %}
                      <tr {% if row.text_style in "bold bold_italic bold_underline all" %}style="font-weight:bold;"{% endif %}>
                        <td class="{{ row.text_style|default:'normal' }}">{{ row.name }}</td>
                        {% for header in data.headers %}
                          <td>{{ row.values|get_itemTest:header.id|default:"" }}</td>
                        {% endfor %}
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            {% else %}
              <p style="text-align:center; color:#666;">No data available.</p>
            {% endif %}
          {% endwith %}
        </section>
      </div>
    </section>

    <!-- Right (20%) -->
    <aside id="cs-events" class="cs-right-sidebar">
      <h3 style="text-align: center;">Events</h3>
      {% if events|length > 10 %}
        <div style="max-height:600px; overflow-y:auto;">
      {% else %}
        <div>
      {% endif %}
        <ul class="list-group">
          {% for event in events %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div class="d-flex align-items-center">
                {% if event.image %}
                  <img src="{{ event.image.url }}" alt="{{ event.title }}" 
                      style="width: 60px; height: 60px; object-fit: cover; margin-right: 15px;">
                {% endif %}
                <div>
                  <h5 class="mb-1" style="font-size: 16px;">{{ event.title }}</h5>
                  <small class="text-muted">{{ event.subtitle|default:"" }}</small>
                </div>
              </div>
              <div>
                <a href="{% url 'SM_User:event_pdf' event.pk %}" class="btn btn-sm btn-outline-primary">
                  <i class="bi bi-download"></i> 
                </a>
              </div>
            </li>
          {% empty %}
            <li class="list-group-item">No events available.</li>
          {% endfor %}
        </ul>
      </div>
    </aside>
  </section>
</div>

<script>
  function csShowSection(id) 
  {
    const sections = document.querySelectorAll('.cs-content-section, #overview');
    const buttons = document.querySelectorAll('.cs-buttons button');
    const sidebar = document.getElementById('cs-events');

    // Hide all sections
    sections.forEach(sec => sec.style.display = 'none');
    buttons.forEach(btn => btn.classList.remove('cs-active'));

    // Show target
    const target = document.getElementById(id);
    if (target) target.style.display = 'block';

    // Sidebar only for overview
    if (id === 'overview') {
      sidebar.style.display = 'block';
    } else {
      sidebar.style.display = 'none';
    }

    // Highlight active button
    const activeBtn = document.querySelector(`.cs-buttons button[onclick="csShowSection('${id}')"]`);
    if (activeBtn) activeBtn.classList.add('cs-active');

    // Smooth scroll
    window.scrollTo({ top: 900, behavior: 'smooth' });
  }

  // Default
  // window.onload = () => {
  //   csShowSection('overview');
  // };
</script>

  <!-- part 5 start -->

        <!-- shareholder table start  -->
        <!-- <section class="stock-shareholding-section">
              {% load humanize %}
              {% if shareholdings %}
              <div class="stock-overview-text">
                <h2>Shareholding Pattern for {{ stock.company_name }}</h2>
              </div>
              <div class="stock-overview-table">
                <table>
                  <thead>
                    <tr style="background-color: #f2f2f2;">
                      <th>Shareholder</th>
                      <th>No. of Shares</th>
                      <th>% of Total</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for holder in shareholdings %}
                    <tr>
                      <td>{{ holder.shareholder_name }}</td>
                      <td>{{ holder.number_of_shares|intcomma }}</td>
                      <td>{{ holder.percentage_of_total|floatformat }}%</td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
              {% endif %}

        </section> -->
        <!-- shareholder table end  -->

        <!-- <main style="max-width: 1235px; margin: 0 auto; padding: 20px; font-family: &quot;Outfit&quot;, sans-serif;"> -->

                  <!-- statrt principalBusinessActivity -->
                    <!-- {% if principalBusinessActivity %}
                        <h2 style="color: #000;
                            font-size: 22px;
                            font-weight: 600;
                            margin-bottom: 20px;
                            margin-top: 20px;padding: 20px;">
                            {{stock.company_name}} Principal Business Activities </h2> 
                        <table class="table table-bordered" style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                          <thead>
                              <tr style="background-color: #f2f2f2;">
                                  <th style="text-align: left; padding: 10px; border: 1px solid #ccc;font-size: 18px;"> 
                                    Name and Description of main products/services</th>
                                  <th style="text-align: left; padding: 10px; border: 1px solid #ccc;font-size: 18px;">NIC Code of the product/service</th>
                                  <th style="text-align: left; padding: 10px; border: 1px solid #ccc;font-size: 18px;">% to total turnover of the Company</th>
                              </tr>
                          </thead>
                          <tbody>
                              {% for principalB in principalBusinessActivity %}
                                  <tr style="background-color: #f9f9f9;">
                                      <td style="padding: 10px; border: 1px solid #ccc;font-size: 18px;">{{ principalB.product_service_name }}</td>
                                      <td style="padding: 10px; border: 1px solid #ccc;font-size: 18px;">{{ principalB.nic_code }}</td>
                                      <td style="padding: 10px; border: 1px solid #ccc;font-size: 18px;">{{ principalB.turnover_percentage }}</td>
                                  </tr>
                              {% endfor %}
                          </tbody>
                        </table>
                    {% endif %} -->
                  <!-- end principalBusinessActivity -->

                  <!-- company subsidiary start -->
                    <!-- {% if relations %}
                        <h2 style="
                        color: #000;
                        font-size: 22px;
                        font-weight: 600;
                        margin-bottom: 20px;
                        margin-top: 20px;padding: 20px;">{{stock.company_name}} Particulars of Subsidiary and Associate Companies </h2> 
                        <table class="table table-bordered" style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                          <thead>
                              <tr style="background-color: #f2f2f2;">
                                  <th style="text-align: left; padding: 10px; border: 1px solid #ccc;font-size: 18px;">Company Name</th>
                                  <th style="text-align: left; padding: 10px; border: 1px solid #ccc;font-size: 18px;">Relation Type</th>
                                  {% if relations.first.percentage_shares_held %}
                                  <th style="text-align: left; padding: 10px; border: 1px solid #ccc;font-size: 18px;">%</th>
                                  {% endif %}
                              </tr>
                          </thead>
                          <tbody>
                              {% for relation in relations %}
                                  <tr style="background-color: #f9f9f9;">
                                      <td style="padding: 10px; border: 1px solid #ccc;font-size: 18px;">{{ relation.company_name }}</td>
                                      <td style="padding: 10px; border: 1px solid #ccc;font-size: 18px;">{{ relation.get_relation_type_display }}</td>
                                      {% if  relation.percentage_shares_held %}
                                      <td style="padding: 10px; border: 1px solid #ccc;font-size: 18px;">{{ relation.percentage_shares_held|floatformat:2 }}</td>
                                      {% endif %}
                                  </tr>
                              {% endfor %}
                          </tbody>
                        </table>
                    {% endif %} -->
                  <!-- company subsidary end -->

                  <!-- shareholder start  -->
                      <!-- {% load humanize %}
                      {% if shareholdings %}
                          <h2  style="
                          color: #000;
                          font-size: 22px;
                          font-weight: 600;
                          margin-bottom: 20px;
                          margin-top: 20px;padding: 20px;">
                          Shareholding Pattern for {{ stock.company_name }}</h2>
                          <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                              <thead>
                                  <tr style="background-color: #f2f2f2;">
                                      <th style="text-align: left; padding: 10px; border: 1px solid #ccc;font-size: 18px;">Shareholder</th>
                                      <th style="text-align: right; padding: 10px; border: 1px solid #ccc;font-size: 18px;">No. of Shares</th>
                                      <th style="text-align: right; padding: 10px; border: 1px solid #ccc;font-size: 18px;">% of Total</th>
                                  </tr>
                              </thead>
                              <tbody>
                                  {% for holder in shareholdings %}
                                      <tr>
                                          <td style="padding: 10px; border: 1px solid #ccc;font-size: 18px;">{{ holder.shareholder_name }}</td>
                                          <td style="padding: 10px; text-align: right; border: 1px solid #ccc;font-size: 18px;">{{ holder.number_of_shares|intcomma }}</td>
                                          <td style="padding: 10px; text-align: right; border: 1px solid #ccc;font-size: 18px;">{{ holder.percentage_of_total|floatformat }}%</td>
                                      </tr>
                                  {% endfor %}
                              </tbody>
                          </table>
                      {% endif %} -->
                  <!-- shareholder end -->

                      <!-- start FAQ -->
                        <!-- {% if faqs %}
                          {% if faqs is not None %}
                            <h2 style="
                            color: #000;
                            font-size: 22px;
                            font-weight: 600;
                            margin-bottom: 20px;
                            margin-top: 20px;padding: 20px;">FAQs for {{ stock.company_name }}</h2>
                            <ul style="list-style: none; padding: 0;">
                              {% for faq in faqs %}
                                <li style="margin-bottom: 20px; padding: 15px; background-color: #f0f8ff; border-left: 4px solid #007acc;font-size: larger;">
                                  <strong style="color: #007acc;">Q:</strong>
                                  <span style="font-weight: bold;">{{ faq.question }}</span><br>
                                  <strong style="color: #28a745;">A:</strong>
                                  <span>{{ faq.answer }}</span>
                                </li>
                              {% endfor %}
                            </ul>
                          {% endif %}
                        {% endif %} -->
                      <!-- End FAQ -->
        <!-- </main> -->

  <!-- part 5 end  -->   


<!-- part 6 Start  most searched -->  
            <!-- most searched  start -->
            <!-- <main>          
                <div class="carousel-container-main">
                    <div class="carousel-title-main">
                        <span style="color: #000;"> Most Searched </span> <span style="color: #39B54A;">Unlisted</span>
                        <span style="color: #000;">&amp; </span>
                        <span style="color: #39B54A;">Pre IPO</span>
                        <span style="color: #000;">Companies Stocks in India</span>
  
                    </div>
                    <div class="carousel-content">
                        <div class="nav-arrow left" onclick="scrollLeftsroll()">
                            <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg" class="nav-arrow left" style="width: 40px; height: 40px; cursor: pointer">
                                <path d="M19.9052 14.8528L17.3342 12.2818L9.61789 19.9964L17.3324 27.7109L19.9033 25.1382L16.5815 21.8146H30.2852V18.1782H16.5815L19.9052 14.8528Z" fill="white"></path>
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M5.85818 5.85818C-1.95273 13.6691 -1.95273 26.3309 5.85818 34.1418C13.6691 41.9527 26.3309 41.9527 34.1418 34.1418C41.9527 26.3309 41.9527 13.6691 34.1418 5.85818C26.3309 -1.95273 13.6691 -1.95273 5.85818 5.85818ZM8.42909 8.42909C6.90958 9.9486 5.70424 11.7525 4.88188 13.7379C4.05952 15.7232 3.63626 17.8511 3.63626 20C3.63626 22.1489 4.05952 24.2768 4.88188 26.2621C5.70424 28.2475 6.90958 30.0514 8.42909 31.5709C9.9486 33.0904 11.7525 34.2958 13.7379 35.1181C15.7232 35.9405 17.8511 36.3637 20 36.3637C22.1489 36.3637 24.2768 35.9405 26.2621 35.1181C28.2475 34.2958 30.0514 33.0904 31.5709 31.5709C34.6397 28.5021 36.3637 24.3399 36.3637 20C36.3637 15.6601 34.6397 11.4979 31.5709 8.42909C28.5021 5.36029 24.3399 3.63626 20 3.63626C15.6601 3.63626 11.4979 5.36029 8.42909 8.42909Z" fill="white"></path>
                            </svg>
                        </div>
                        <div class="scroll-container-main" id="scrollContainer1">
                          {% for stock in all_stocks %}
                            <div class="company-card-main">
                                <a href="{% url 'unlisted_stock_marketplace:stock_detail' stock.id %}" 
                                  style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 12px;">
                                  
                                  <div style="width: 40px; height: 40px; flex-shrink: 0;">
                                    {% if stock.logo %}
                                      <img src="{{ stock.logo.url }}" alt="{{ stock.company_name }} Logo" 
                                          style="width: 100%; height: 100%; object-fit: contain;">
                                    {% endif %}
                                  </div>
                                  
                                  <div style="font-weight: 600; font-size: 1rem;">
                                    {{ stock.company_name }}
                                  </div>
                                </a>

                                <div class="company-sector-main"><span>Sector:</span>&nbsp;&nbsp;{{stock.sector}}</div>
                                <div class="company-ltp-main">
                                  <span>LTP:</span>
                                  {% if stock.ltp and stock.share_price %}
                                      {{ stock.ltp }}
                                      {% if stock.profit > 0 %}
                                          <p>
                                            <span style="color: green;">
                                              &#9650; ‚Çπ00{{ stock.profit }} ({{ stock.profit_percentage }}%)
                                            </span>
                                          </p>
                                      {% elif stock.profit < 0 %}
                                          <p>
                                            <span style="color: red;">
                                              &#9660; ‚Çπ{{ stock.profit }} ({{ stock.profit_percentage }}%)
                                            </span>
                                          </p>
                                      {% else %}
                                          <p>
                                            <span style="color: rgb(0, 0, 0);">
                                              ‚Çπ{{ stock.profit }} ({{ stock.profit_percentage }}%)
                                            </span>
                                          </p>
                                      {% endif %}
                                  {% else %}
                                      <span>No LTP data available</span>
                                  {% endif %}
                                </div>
                                <div class="market-cap-main"><span>Market Cap:</span>&nbsp;&nbsp;‚Çπ{{stock.market_capitalization}} Crore</div>
                                <div class="details-company-main">
                                    <div class="company-eps-div"><span>EPS:</span>‚Çπ{{stock.eps}}</div>
                                    <div class="company-eps-div"><span>PE Ratio:</span>{{stock.pe_ratio}}</div>
                                </div>
                                <div class="details-company-main">
                                    <div class="company-eps-div"><span>BV:</span>‚Çπ{{stock.book_value}}</div>
                                    <div class="company-eps-div"><span>P/BV:</span>{{stock.pbv}}</div>
                                </div>
                                <div class="details-company-main">
                                    <div class="company-eps-div"><span>FV:</span>‚Çπ{{stock.face_value}}</div>
                                    <div class="company-eps-div"><span>Shares:</span>{{stock.outstanding_shares}}</div>
                                </div>
                            </div>
                          {% endfor %}
                        </div>
                        <div class="nav-arrow right" onclick="scrollRightscroll()">
                          <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg" class="nav-arrow right" style="width: 40px; height: 40px; cursor: pointer">
                              <path d="M20.0948 25.1472L22.6658 27.7182L30.3821 20.0036L22.6676 12.2891L20.0967 14.8618L23.4185 18.1854H9.71484V21.8218H23.4185L20.0948 25.1472Z" fill="white"></path>
                              <path fill-rule="evenodd" clip-rule="evenodd" d="M34.1418 34.1418C41.9527 26.3309 41.9527 13.6691 34.1418 5.85818C26.3309 -1.95273 13.6691 -1.95273 5.85818 5.85818C-1.95273 13.6691 -1.95273 26.3309 5.85818 34.1418C13.6691 41.9527 26.3309 41.9527 34.1418 34.1418ZM31.5709 31.5709C33.0904 30.0514 34.2958 28.2475 35.1181 26.2621C35.9405 24.2768 36.3637 22.1489 36.3637 20C36.3637 17.8511 35.9405 15.7232 35.1181 13.7379C34.2958 11.7525 33.0904 9.9486 31.5709 8.42909C30.0514 6.90958 28.2475 5.70423 26.2621 4.88188C24.2768 4.05952 22.1489 3.63626 20 3.63626C17.8511 3.63626 15.7232 4.05952 13.7379 4.88188C11.7525 5.70423 9.9486 6.90958 8.42909 8.42909C5.3603 11.4979 3.63626 15.6601 3.63626 20C3.63626 24.3399 5.3603 28.5021 8.42909 31.5709C11.4979 34.6397 15.6601 36.3637 20 36.3637C24.3399 36.3637 28.5021 34.6397 31.5709 31.5709Z" fill="white"></path>
                          </svg>
                        </div>
                    </div>
                </div>
            </main> -->
    <section class="carousel-container-main">
        <div class="carousel-title-main">
            Most Searched <span class="highlight">Unlisted</span> & <span class="highlight">Pre IPO</span> Companies Stocks in india
        </div>
        <div class="carousel-content">
            <div class="nav-arrow left" onclick="scrollLeftsroll()">
                <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg" class="nav-arrow left" style="width: 40px; height: 40px; cursor: pointer">
                    <path d="M19.9052 14.8528L17.3342 12.2818L9.61789 19.9964L17.3324 27.7109L19.9033 25.1382L16.5815 21.8146H30.2852V18.1782H16.5815L19.9052 14.8528Z" fill="black"></path>
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M5.85818 5.85818C-1.95273 13.6691 -1.95273 26.3309 5.85818 34.1418C13.6691 41.9527 26.3309 41.9527 34.1418 34.1418C41.9527 26.3309 41.9527 13.6691 34.1418 5.85818C26.3309 -1.95273 13.6691 -1.95273 5.85818 5.85818ZM8.42909 8.42909C6.90958 9.9486 5.70424 11.7525 4.88188 13.7379C4.05952 15.7232 3.63626 17.8511 3.63626 20C3.63626 22.1489 4.05952 24.2768 4.88188 26.2621C5.70424 28.2475 6.90958 30.0514 8.42909 31.5709C9.9486 33.0904 11.7525 34.2958 13.7379 35.1181C15.7232 35.9405 17.8511 36.3637 20 36.3637C22.1489 36.3637 24.2768 35.9405 26.2621 35.1181C28.2475 34.2958 30.0514 33.0904 31.5709 31.5709C34.6397 28.5021 36.3637 24.3399 36.3637 20C36.3637 15.6601 34.6397 11.4979 31.5709 8.42909C28.5021 5.36029 24.3399 3.63626 20 3.63626C15.6601 3.63626 11.4979 5.36029 8.42909 8.42909Z" fill="black"></path>
                </svg>
            </div>
            <div class="scroll-container-main" id="scrollContainer1">
                {% for stock in all_stocks %}
                    <div class="company-card-main">
                        <a href="{% url 'unlisted_stock_marketplace:stock_detail' stock.id %}" class="card-link">
                            <div class="logo-main">
                                {% if stock.logo %}
                                    <img src="{{ stock.logo.url }}" alt="{{ stock.company_name }} Logo" class="company-logo-main">
                                {% endif %}
                            </div>
                            <div class="company-name-main">
                                {{ stock.company_name }}
                            </div>
                            <div class="company-sector-main"><span>Sector:</span>&nbsp;&nbsp;{{stock.sector}}</div>
                            <div class="company-ltp-main">
                                  <span>CMP:</span>
                                  {% if stock.ltp and stock.share_price %}
                                      {{ stock.ltp }}

                                      {% load humanize %}

                                      {% if stock.profit > 0 %}
                                        <p><span style="color: green;">
                                          &#9650; ‚Çπ{{ stock.profit|floatformat:2|intcomma }} ({{ stock.profit_percentage|floatformat:2 }}%)
                                        </span></p>
                                      {% elif stock.profit < 0 %}
                                        <p><span style="color: red;">
                                          &#9660; ‚Çπ{{ stock.profit|floatformat:2|intcomma }} ({{ stock.profit_percentage|floatformat:2 }}%)
                                        </span></p>
                                      {% else %}
                                        <p><span>
                                          ‚Çπ{{ stock.profit|floatformat:2 }} ({{ stock.profit_percentage|floatformat:2 }}%)
                                        </span></p>
                                      {% endif %}

                                  {% else %}
                                      <span>No LTP data available</span>
                                  {% endif %}
                            </div>
                            <div class="details-company-main">
                                <div class="company-eps-div"><span>Lot :</span>‚Çπ{{ stock.lot }}</div>
                            </div>
                            <div class="market-cap-main"><span>Market Cap:</span>&nbsp;&nbsp;‚Çπ{{stock.market_capitalization}} Crore</div>
                            <div class="details-company-main">
                                <div class="company-eps-div"><span>Face Value:</span>‚Çπ{{stock.face_value}}</div>
                                <div class="company-eps-div"><span>PE Ratio:</span>{{stock.pe_ratio}}</div>
                            </div>
                        </a>
                        <div class="details-cards-fourth-info">
                            <button class="cards-buy-button" onclick='openBuyModal(
                            "{{ stock.id }}",
                            "{{ stock.company_name|escapejs }}",
                            "{{ stock.share_price }}",
                            "{{ stock.quantity }}",
                            "{% url 'user_portfolio:buy_stock' stock.id %}"
                          )'>Buy</button>

                            <button class="cards-sell-button" onclick='openSellModal(
                            "{{ stock.id }}",
                            "{{ stock.company_name|escapejs }}",
                            "{{ stock.share_price }}",
                            "{{ stock.quantity }}",
                            "{% url 'user_portfolio:sell_stock' stock.id %}"
                          )'>Sell</button>

                        </div>
                    </div>
                {% endfor %}
            </div>
            <div class="nav-arrow right" onclick="scrollRightscroll()">
                <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg" class="nav-arrow right" style="width: 40px; height: 40px; cursor: pointer">
                    <path d="M20.0948 25.1472L22.6658 27.7182L30.3821 20.0036L22.6676 12.2891L20.0967 14.8618L23.4185 18.1854H9.71484V21.8218H23.4185L20.0948 25.1472Z" fill="black"></path>
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M34.1418 34.1418C41.9527 26.3309 41.9527 13.6691 34.1418 5.85818C26.3309 -1.95273 13.6691 -1.95273 5.85818 5.85818C-1.95273 13.6691 -1.95273 26.3309 5.85818 34.1418C13.6691 41.9527 26.3309 41.9527 34.1418 34.1418ZM31.5709 31.5709C33.0904 30.0514 34.2958 28.2475 35.1181 26.2621C35.9405 24.2768 36.3637 22.1489 36.3637 20C36.3637 17.8511 35.9405 15.7232 35.1181 13.7379C34.2958 11.7525 33.0904 9.9486 31.5709 8.42909C30.0514 6.90958 28.2475 5.70423 26.2621 4.88188C24.2768 4.05952 22.1489 3.63626 20 3.63626C17.8511 3.63626 15.7232 4.05952 13.7379 4.88188C11.7525 5.70423 9.9486 6.90958 8.42909 8.42909C5.3603 11.4979 3.63626 15.6601 3.63626 20C3.63626 24.3399 5.3603 28.5021 8.42909 31.5709C11.4979 34.6397 15.6601 36.3637 20 36.3637C24.3399 36.3637 28.5021 34.6397 31.5709 31.5709Z" fill="black"></path>
                </svg>
            </div>
        </div>
    </section>
<!-- part 6 end most searched  -->            

    <!-- js for most searched start -->
    <script>
          function getVisibleCards() {
              const container = document.getElementById('scrollContainer1');
              const containerWidth = container.offsetWidth;
              const card = document.querySelector('.company-card-main');
              const cardWidth = card.offsetWidth + 15; // width + gap
              
              return Math.floor(containerWidth / cardWidth);
          }

          function scrollLeftsroll() {
              const container = document.getElementById('scrollContainer1');
              const cardsToScroll = getVisibleCards();
              const card = document.querySelector('.company-card-main');
              const scrollAmount = (card.offsetWidth + 15) * cardsToScroll;
              
              container.scrollBy({
                left: -scrollAmount,
                behavior: 'smooth'
              });
          }
            
          function scrollRightscroll() {
              const container = document.getElementById('scrollContainer1');
              const cardsToScroll = getVisibleCards();
              const card = document.querySelector('.company-card-main');
              const scrollAmount = (card.offsetWidth + 15) * cardsToScroll;
              
              container.scrollBy({
                left: scrollAmount,
                behavior: 'smooth'
              });
          }
    </script>
    <!-- js for most searched end -->

{% endblock %}