{% extends 'base.html' %}

{% block title %}Stock Details{% endblock %}
{% load custom_filters %}
{% load custom_filter_overviewDetailedStock %}
{% block content %}
<style>
    /* .stock-page-header {
        text-align: center;
        margin-bottom: 20px;
        padding: 75px;
        background-color: #f8f9fa; 
        box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
        font-size: 2em;
        color: aliceblue;
        background: radial-gradient(
            64.54% 23.63% at 69.24% 61.54%,
            #271b3f 0%,
            #271b3f 43.09%,
            #341a47 68.59%,
            #0e213f 100%
        );
    } */

    /* .header-content {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        max-width: 80%;
        margin: auto;
    } */

    /* .header-left {
        flex: 1;
        max-width: 40%;
    } */

    /* .company-logo {
        max-width: 100px;
        height: auto;
        margin-bottom: 10px;
    } */

    /* .header-buttons {
        display: flex;
        gap: 8px;
        margin-top: 10px;
    } */

    /* .stock-btn {
        padding: 10px 15px;
        font-size: 16px;
        text-decoration: none;
        color: white;
        border-radius: 5px;
        font-weight: bold;
        transition: 0.3s;
        width: 100px;
        text-align: center;
    }

    .buy-btn {
        background-color: #28a745;
        width: 100px;
    }

    .sell-btn {
        background-color: #dc3545;
    }

    .stock-btn:hover {
        opacity: 0.8;
    } */

    /* .header-right {
        flex: 2;
        max-width: 60%;
    }


    .header-right h2 {
        margin: 0;
        font-size: 24px;
        color: #fff;
    }

    .header-right p {
        margin: 5px 0;
        font-size: 18px;
        color: #ddd;
    } */

    /* Stock Details Section */
    .stock-details {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        margin-top: 20px;
        padding: 20px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        max-width: 80%;
        margin-left: auto;
        margin-right: auto;
    }

    .details-column {
        padding: 10px;
        text-align: center;
    }

    .details-column p {
        margin: 5px 0;
        font-size: 16px;
        color: #fff;
    }

    /* Table Styling */
    .stock-table-container {
        margin: 40px auto;
        width: 90%;
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
    }

    .stock-table {
        width: 100%;
        border-collapse: collapse;
    }

    .stock-table th, .stock-table td {
        border: 1px solid #ddd;
        padding: 12px;
        text-align: left;
    }

    .stock-table th {
        background: #343a40;
        color: white;
    }

    .stock-table tr:nth-child(even) {
        background: #f2f2f2;
    }
    /* .chart-container {
        width: 80%;
        max-width: 900px;
        height: 400px;
        margin: 40px auto;
        background: #0E213F;  
        padding: 20px;
        border-radius: 10px;
        box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
        color: white;
    } */

    
    /* .chart-container {
        width: 100%;
        padding: 80px 30px 50px 20px;
        background: #0E213F;
        border-radius: 10px;
        margin-top: 20px;
        text-align: center;
        color: white;
    }
     */
   /* .chart-wrapper {
        position: relative;
        max-width: 90%;
        margin: auto;
    } */

    /* .filter-buttons {
        position: absolute;
        top: 0;
        right: 0;
        border-radius: 10px;
    } */

    /* .filter-btn {
        padding: 6px 8px;
        font-size: 12px;
        margin: 15px 0px 3px 0px;
        cursor: pointer;
        border: 1px solid yellow;
        background: transparent;
        color: white;
        font-weight: bold;
        transition: 0.3s;
    } */

    /* .filter-btn:hover {
        background: yellow;
        color: black;
    } */


    /* canvas {
        max-width: 100%;
        height: 400px !important;
    } */
    .styled-card {
      border: 2px solid yellow;
      padding: px;
      text-align: center;
      width: 250px;
      border-radius: 10px;
      background-color: transparent;
    }

    /* .company-logo {
      width: 100%;
      height: auto;
      border: 2px solid yellow;
      margin-bottom: 15px;
    } */

    /* .header-buttons {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
    } */

    .stock-btn.yellow-btn {
      flex: 1;
      margin: 0 5px;
      padding: 10px;
      background-color: transparent;
      color: white;
      border: 2px solid yellow;
      border-radius: 5px;
      font-weight: bold;
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }

  /* Arrow styles */
  .nav-arrow {
    cursor: pointer;
    z-index: 2;
  }

  @media screen and (max-width: 1200px) {
    .nav-arrow {
      width: 35px;
      height: 35px;
    }

    .nav-arrow.left {
      left: -35px;
    }

    .nav-arrow.right {
      right: -35px;
    }
  }

  @media screen and (max-width: 992px) {
    .nav-arrow {
      width: 30px;
      height: 30px;
    }

    .nav-arrow.left {
      left: -30px;
    }

    .nav-arrow.right {
      right: -30px;
    }
  }

  @media screen and (max-width: 768px) {
    .nav-arrow {
      width: 26px;
      height: 26px;
    }

    .nav-arrow.left {
      left: -20px;
    }

    .nav-arrow.right {
      right: -20px;
    }
  }

  @media screen and (max-width: 480px) {
    .nav-arrow {
      width: 22px;
      height: 22px;
    }

    .nav-arrow.left {
      left: -10px;
    }

    .nav-arrow.right {
      right: -10px;
    }
  }
</style>
<!-- part 1 start -->
<div class="stock-page-header-1">
  <div class="header-content-details">
    <!-- stock data buy sell wishlist left options start -->
    <div class="header-details-left" style="margin-left: 20px;">
        <div class="header-details-logo-left">
            {% if stock.logo %}
                <img src="{{ stock.logo.url }}" alt="{{ stock.company_name }} Logo" class="company-logo-1">
            {% endif %}
        </div>
        <div class="header-details-buttons">
          <a href="javascript:void(0);"
            onclick='openBuyModal(
                        "{{ stock.id }}",
                        "{{ stock.company_name|escapejs }}",
                        "{{ stock.share_price }}",
                        "{{ stock.quantity }}",
                        "{% url 'user_portfolio:buy_stock' stock.id %}"
                      )'
          >Buy</a>
          <a href="javascript:void(0);"
            onclick='openSellModal(
                "{{ stock.id }}",
                "{{ stock.company_name|escapejs }}",
                "{{ stock.share_price }}",
                "{{ stock.quantity }}",
                "{% url 'user_portfolio:sell_stock' stock.id %}"
              )'
          >Sell</a>
        </div>
        <div class="header-details-whishlist">
          <button
              data-stock-id="{{ stock.id }}" 
              data-stock-name="{{ stock.company_name }}" 
              data-url="{% url 'unlisted_stock_marketplace:get_next_wishlist_group_name' %}" 
          >Wishlist üõí</button>
        </div>
    </div>
    <!-- stock data buy sell wishlist left options end -->
    <!-- stock data price LEP left options start -->


    <!-- <div class="header-details-right">
      <h2>{{ stock.company_name }}</h2>
      <p><strong>Price:</strong> ‚Çπ{{ stock.share_price }}</p>
      <p><strong>Last Entry Price:</strong> ‚Çπ{{ stock.ltp }}</p>
      {% if stock.profit > 0 %}
        <p>
          <strong>Profit/Loss:</strong>
          <span style="color: green;">&#9650; ‚Çπ{{ stock.profit|floatformat:2 }} ({{ stock.profit_percentage|floatformat:2 }}%)</span>
        </p>
        {% elif stock.profit < 0 %}
          <p>
            <strong>Profit/Loss:</strong>
            <span style="color: red;">&#9660; ‚Çπ{{ stock.profit|floatformat:2 }} ({{ stock.profit_percentage|floatformat:2 }}%)</span>
          </p>
        {% else %}
          <p>
            <strong>Profit/Loss:</strong>
            <span style="color: white;">‚Çπ0.00 (0.00%)</span>
          </p>
        {% endif %}

    </div> -->


    <div class="header-details-right" style="background: linear-gradient(to right, #0a2342, #36144b); padding: 20px; border-radius: 10px; color: white; font-family: 'Georgia', serif;">
      <h1 style="font-size: 36px; font-weight: bold; margin-bottom: 10px;">
        {{ stock.company_name }} 
      </h1>

      <p style="color: gold; font-size: 20px; font-weight: bold; margin-bottom: 0;">
        Last Traded Price
      </p>

      <p style="font-size: 32px; margin: 5px 0;">
        ‚Çπ{{ stock.share_price|floatformat:2 }}
        {% if stock.profit > 0 %}
          <span style="color: #00ff00; font-weight: bold;">
            ( + {{ stock.profit_percentage|floatformat:2 }} % )
          </span>
          <span style="font-size: 24px;">‚≠ê ‚≠ê</span>
        {% elif stock.profit < 0 %}
          <span style="color: #ff4c4c; font-weight: bold;">
           ( {{ stock.profit_percentage|floatformat:2 }} % )
          </span>
          <span style="font-size: 24px;">üîª</span>
        {% else %}
          <span style="color: #ffffff;">
           ( 0.00 % )
          </span>
        {% endif %}
      </p>
    </div>

    <!-- stock data price LEP left options end -->
  </div>
</div>
<!-- part 1 end -->

<!-- part 2 start -->
<!-- stock data top table details options start -->
  <section class="stock-info-section">
    <div class="stock-info-container">
      <div class="stock-info-block">
        <h3>Company Name</h3>
        <p>{{ stock.company_name }}</p>
        <hr />
      </div>
      <!-- <div class="stock-info-block">
        <h3>Script Name</h3>
        <p>{{stock.scrip_name}}</p>
        <hr/>
      </div> -->
      <div class="stock-info-block">
        <h3>ISIN No.</h3>
        <p>{{stock.isin_no}}</p>
        <hr/>
      </div>
      <div class="stock-info-block">
        <h3>No. of Outstanding Shares</h3>
        <p>{{ stock.outstanding_shares }}</p>
        <hr />
      </div>
      <div class="stock-info-block">
        <h3>PAN No.</h3>
        <p>{{stock.pan_no}}</p>
        <hr/>
      </div>
      <div class="stock-info-block">
        <h3>Face Value</h3>
        <p>‚Çπ {{stock.face_value}}</p>
        <hr/>
      </div>
      <div class="stock-info-block">
        <h3>EPS</h3>
        <p>‚Çπ{{ stock.eps }}</p>
        <hr />
      </div>
      <div class="stock-info-block">
        <h3>PE ratio</h3>
        <p>{{stock.pe_ratio}}</p>
        <hr />
      </div>
      <div class="stock-info-block">
        <h3>P/S Ratio</h3>
        <p>{{stock.ps_ratio}}</p>
        <hr />
      </div>
      <div class="stock-info-block">
        <h3>Market Capitalization (in Cr)</h3>
        <p>‚Çπ{{ stock.market_capitalization }}</p>
        <!-- <p>‚Çπ{{ stock.outstanding_shares }} * {{ stock.ltp }} Crore</p> -->
        <hr />
      </div>
      <div class="stock-info-block">
        <h3>Book value</h3>
        <p>‚Çπ{{ stock.book_value }}</p>
        <hr />
      </div>
      <div class="stock-info-block">
        <h3>P/BV</h3>
        <p>{{stock.pbv}}</p>
        <hr />
      </div>
      <!-- <div class="stock-info-block">
        <h3>52 Week High</h3>
        <p>‚Çπ{{ stock.week_52_high }}</p>
        <hr />
      </div> -->
      <!-- <div class="stock-info-block">
        <h3>Lifetime High</h3>
        <p>‚Çπ{{ stock.lifetime_high }} {{ stock.lifetime_high_date }}</p>
        <hr />
      </div> -->
      <!-- <div class="stock-info-block">
        <h3>Day High</h3>
        <p>‚Çπ {{stock.day_high}}</p>
        <hr />
      </div> -->
      <!-- <div class="stock-info-block">
        <h3>52 Week Low</h3>
        <p>‚Çπ{{ stock.week_52_low }}</p>
        <hr />
      </div> -->
      <!-- <div class="stock-info-block">
        <h3>Lifetime Low</h3>
        <p>‚Çπ{{ stock.lifetime_low }} {{ stock.lifetime_low_date }}</p>
        <hr />
      </div> -->
      <!-- <div class="stock-info-block">
        <h3>Day Low</h3>
        <p>‚Çπ {{stock.day_low}}</p>
        <hr />
      </div> -->
      <div class="stock-info-block">
        <h3>DRHP Filed?</h3>
        <p>{% if stock.drhp_filed %}
                Yes
            {% else %}
                No
            {% endif %}</p>
        <hr />
      </div>
      <div class="stock-info-block">
        <h3>Available on</h3>
        <p>{{stock.available_on}}</p>
        <hr />
      </div>
      <!-- <div class="stock-info-block">
        <h3>ROFR Require</h3>
        <p>{% if stock.rofr_require %}
              Yes
          {% else %}
              No
          {% endif %}
        </p>
        <hr />
      </div> -->
      <div class="stock-info-block">
        <h3>Sector</h3>
        <p>{{stock.sector}}</p>
        <hr />
      </div>
      <div class="stock-info-block">
        <h3>CIN</h3>
        <p>{{stock.cin}}</p>
        <hr />
      </div>
      <div class="stock-info-block">
        <h3>Registration Date</h3>
        <p>{{stock.registration_date}} </p>
        <hr />
      </div>
    </div>
  </section>
<!-- stock data top table details options end -->
<!-- part 2 end -->

<!-- part 3 start -->
<!-- stock data graph start -->
<section>
  <div class="hero-headers">
    <h1 class="heading">Stock <span class="highlight">Performance</span></h1>
  </div>
  <div class="chart-wrapper">
    <div class="filter-buttons">
      <button class="filter-btn" data-range="7">1W</button>
      <button class="filter-btn" data-range="30">1M</button>
      <button class="filter-btn" data-range="90">3M</button>
      <button class="filter-btn active" data-range="180">6M</button>
      <button class="filter-btn" data-range="365">1Y</button>
      <button class="filter-btn" data-range="730">2Y</button>
      <button class="filter-btn" data-range="1095">3Y</button>
      <button class="filter-btn" data-range="1825">5Y</button>
      <button class="filter-btn" data-range="MAX" style="margin-right :10px ;">MAX</button>
    </div>

    <!-- Chart Container -->
    <div class="chart-container">
      <h3>Stock Price Over Time</h3>
      <canvas id="stockPriceChart" class="canvasDetails"></canvas>
    </div>
  </div>

  <!-- Chart.js Script -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const stockDates = JSON.parse('{{ stock_dates|safe }}'); // e.g. ["2025-01-01","2025-02-01"]
      const stockPrices = JSON.parse('{{ stock_prices|safe }}').map(price => parseFloat(price));
      const parsedDates = stockDates.map(date => new Date(date));

      const ctx = document.getElementById('stockPriceChart').getContext('2d');

      function getDateBefore(days) {
        const d = new Date();
        d.setDate(d.getDate() - days);
        return d;
      }

      function filterData(range) {
        if (range === "MAX") {
          return { labels: parsedDates, data: stockPrices };
        }

        const days = parseInt(range);
        if (!isNaN(days)) {
          const startDate = getDateBefore(days);
          const endDate = new Date();
          const filteredDates = [];
          const filteredPrices = [];

          for (let i = 0; i < parsedDates.length; i++) {
            if (parsedDates[i] >= startDate && parsedDates[i] <= endDate) {
              filteredDates.push(parsedDates[i]);
              filteredPrices.push(stockPrices[i]);
            }
          }

          return { labels: filteredDates, data: filteredPrices };
        }

        return { labels: parsedDates, data: stockPrices }; // fallback
      }

      // üëâ Default to 6 months (180 days)
      const defaultRange = 180;
      const { labels: defaultLabels, data: defaultData } = filterData(defaultRange);

      let stockChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: defaultLabels,
          datasets: [{
            label: 'Stock Price',
            data: defaultData,
            borderColor: 'yellow',
            backgroundColor: 'rgba(255, 255, 0, 0.2)',
            borderWidth: 2,
            pointRadius: 4,
            pointBackgroundColor: 'yellow'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: {
            mode: 'index',
            intersect: false
          },
          scales: {
            x: {
              type: 'time',   // ‚úÖ use time scale
              time: {
                unit: 'month',
                tooltipFormat: 'MMM dd, yyyy',
                displayFormats: {
                  month: 'MMM yyyy' // ‚úÖ only show Month + Year
                }
              },
              title: {
                display: true,
                text: 'Month & Year',
                color: 'white'
              },
              ticks: { color: 'white' }
            },
            y: {
              title: {
                display: true,
                text: 'Stock Price',
                color: 'white'
              },
              ticks: { color: 'white' }
            }
          },
          plugins: {
            legend: {
              labels: { color: 'white' }
            },
            tooltip: {
              mode: 'index',
              intersect: false
            }
          }
        }
      });

      // Add click listeners for range filters
      document.querySelectorAll(".filter-btn").forEach(button => {
        button.addEventListener("click", function () {
          const range = this.getAttribute("data-range");
          const { labels, data } = filterData(range);
          stockChart.data.labels = labels;
          stockChart.data.datasets[0].data = data;
          stockChart.update();
        });
      });
    });
  </script>
</section>

<!-- stock data graph end -->
<!-- part 3 end -->

<!-- part 4 start -->
<section class="company-overall-allDetails">
  <div class="hero-headers">
    <h1 class="heading">Share <span class="highlight">Details</span></h1>
  </div>
  <div class="company-details-buttons">
    <button onclick="showSection('overview')">Overview</button>
    <button onclick="showSection('balance-sheet')">Balance Sheet</button>
    <button onclick="showSection('pl-account')">P&amp;L Account</button>
    <button onclick="showSection('cash-flow')">Cash Flow</button>
    <button onclick="showSection('dividend-history')">Dividend</button>
    <button onclick="showSection('financial-ratios')">Financial Ratios</button>
  </div>
</section>

<!-- Overview Content start -->
<section id="overview" class="stock-overview-section">
  <section class="stock-overview-box">
    <div class="stock-overview-text">
      {{ stock.company_overview|safe }}
    </div>

    {% if reports %}
    <div class="stock-overview-text">
      {% for report in reports %}
        <!-- <h2>{{ report.title }}</h2> -->
        {{ report.summary|safe }}
      {% endfor %}
    </div>
    {% endif %}
  </section>

        <!-- Report Section -->
        <!-- {% if reports %}
          <ul class="stock-report-list">
            {% for report in reports %}
              <li class="stock-report-item">
                <strong class="stock-report-title">{{ report.title }}</strong>
                <div class="stock-report-summary">
                  {{ report.summary|safe }}
                </div>
              </li>
            {% endfor %}
          </ul>
        {% endif %} -->
</section>
<!-- Overview Content end -->

<!-- balance-sheet section start -->
<section id="balance-sheet" class="content-section" style="display: none;">
    <h2>
        {{ stock.company_name }} - Balance Sheet
    </h2>

    {% with data=balance_sheet_data %}
        {% if data.headers and data.rows %}
            <table class="balance-sheet-table">
                <thead>
                    <tr style="background-color: #f2f2f2;">
                        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">
                            {{ data.particulars_header.title }}
                        </th>
                        {% for header in data.headers %}
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: right;">
                                {{ header.title }} (‚Çπ Cr)
                            </th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for row in data.rows %}
                        <tr {% if row.text_style in "bold bold_italic bold_underline all" %}style="font-weight: bold;"{% endif %}>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: left;" class="{{ row.text_style|default:'normal' }}">
                                {{ row.name }}
                            </td>
                            {% for header in data.headers %}
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: right;">
                                    {{ row.values|get_itemTest:header.id|default:"" }}
                                </td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p style="text-align: center; color: #666; font-size: 16px; margin-top: 20px;">
                No data available in this category for this stock.
            </p>
        {% endif %}
    {% endwith %}
</section>
<!-- balance-sheet section end -->

 <!-- pl-account section start -->
<section id="pl-account" class="content-section" style="display: none;">
    <h2 style="color: #000; font-size: 22px; font-weight: 600; margin-bottom: 20px; text-align: center;">
        {{ stock.company_name }} - P & L Account
    </h2>

    {% with data=pl_account_data %}
      {% if data.headers and data.rows %}
          <table style="width: 100%; border-collapse: collapse; font-family: Arial, sans-serif; font-size: 14px;">
              <thead>
                  <tr style="background-color: #f2f2f2;">
                      <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">
                          {{ data.particulars_header.title }}
                      </th>
                      {% for header in data.headers %}
                          <th style="border: 1px solid #ddd; padding: 8px; text-align: right;">
                              {{ header.title }} (‚Çπ Cr)
                          </th>
                      {% endfor %}
                  </tr>
              </thead>
              <tbody>
                  {% for row in data.rows %}
                      <tr {% if row.text_style in "bold bold_italic bold_underline all" %}style="font-weight: bold;"{% endif %}>
                          <td style="border: 1px solid #ddd; padding: 8px; text-align: left;" class="{{ row.text_style|default:'normal' }}">
                              {{ row.name }}
                          </td>
                          {% for header in data.headers %}
                              <td style="border: 1px solid #ddd; padding: 8px; text-align: right;">
                                  {{ row.values|get_itemTest:header.id|default:"" }}
                              </td>
                          {% endfor %}
                      </tr>
                  {% endfor %}
              </tbody>
          </table>
      {% else %}
          <p style="text-align: center; color: #666; font-size: 16px; margin-top: 20px;">
              No data available in this category for this stock.
          </p>
      {% endif %}
    {% endwith %}
</section>
<!-- pl-account section end -->

<!-- cash-flow section start -->
<section id="cash-flow" class="content-section" style="display: none;">
    <h2 style="color: #000; font-size: 22px; font-weight: 600; margin-bottom: 20px; text-align: center;">
        {{ stock.company_name }} - Cash FLow
    </h2>

    {% with data=cash_flow_data %}
      {% if data.headers and data.rows %}
          <table style="width: 100%; border-collapse: collapse; font-family: Arial, sans-serif; font-size: 14px;">
              <thead>
                  <tr style="background-color: #f2f2f2;">
                      <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">
                          {{ data.particulars_header.title }}
                      </th>
                      {% for header in data.headers %}
                          <th style="border: 1px solid #ddd; padding: 8px; text-align: right;">
                              {{ header.title }} (‚Çπ Cr)
                          </th>
                      {% endfor %}
                  </tr>
              </thead>
              <tbody>
                  {% for row in data.rows %}
                      <tr {% if row.text_style in "bold bold_italic bold_underline all" %}style="font-weight: bold;"{% endif %}>
                          <td style="border: 1px solid #ddd; padding: 8px; text-align: left;" class="{{ row.text_style|default:'normal' }}">
                              {{ row.name }}
                          </td>
                          {% for header in data.headers %}
                              <td style="border: 1px solid #ddd; padding: 8px; text-align: right;">
                                  {{ row.values|get_itemTest:header.id|default:"" }}
                              </td>
                          {% endfor %}
                      </tr>
                  {% endfor %}
              </tbody>
          </table>
      {% else %}
          <p style="text-align: center; color: #666; font-size: 16px; margin-top: 20px;">
              No data available in this category for this stock.
          </p>
      {% endif %}
    {% endwith %}
</section>
<!-- cash-flow section end -->

<!-- dividend-history section start -->
<section id="dividend-history" class="content-section" style="display: none;">
    <h2 style="color: #000; font-size: 22px; font-weight: 600; margin-bottom: 20px; text-align: center;">
        {{ stock.company_name }} - Dividend History
    </h2>

    {% with data=dividend_data %}
      {% if data.headers and data.rows %}
          <table style="width: 100%; border-collapse: collapse; font-family: Arial, sans-serif; font-size: 14px;">
              <thead>
                  <tr style="background-color: #f2f2f2;">
                      <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">
                          {{ data.particulars_header.title }}
                      </th>
                      {% for header in data.headers %}
                          <th style="border: 1px solid #ddd; padding: 8px; text-align: right;">
                              {{ header.title }} (‚Çπ Cr)
                          </th>
                      {% endfor %}
                  </tr>
              </thead>
              <tbody>
                  {% for row in data.rows %}
                      <tr {% if row.text_style in "bold bold_italic bold_underline all" %}style="font-weight: bold;"{% endif %}>
                          <td style="border: 1px solid #ddd; padding: 8px; text-align: left;" class="{{ row.text_style|default:'normal' }}">
                              {{ row.name }}
                          </td>
                          {% for header in data.headers %}
                              <td style="border: 1px solid #ddd; padding: 8px; text-align: right;">
                                  {{ row.values|get_itemTest:header.id|default:"" }}
                              </td>
                          {% endfor %}
                      </tr>
                  {% endfor %}
              </tbody>
          </table>
            {% else %}
          <p style="text-align: center; color: #666; font-size: 16px; margin-top: 20px;">
              No data available in this category for this stock.
          </p>
      {% endif %}
    {% endwith %}
</section>
<!-- dividend-history section end -->

<!-- financial-ratios section start -->
<section id="financial-ratios" class="content-section" style="display: none;">
    <h2 style="color: #000; font-size: 22px; font-weight: 600; margin-bottom: 20px; text-align: center;">
        {{ stock.company_name }} - Financial Ratios
    </h2>

    {% with data=financial_ratios_data %}
        {% if data.headers and data.rows %}
            <table style="width: 100%; border-collapse: collapse; font-family: Arial, sans-serif; font-size: 14px;">
                <thead>
                    <tr style="background-color: #f2f2f2;">
                        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">
                            {{ data.particulars_header.title }}
                        </th>
                        {% for header in data.headers %}
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: right;">
                                {{ header.title }} (‚Çπ Cr)
                            </th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for row in data.rows %}
                        <tr {% if row.text_style in "bold bold_italic bold_underline all" %}style="font-weight: bold;"{% endif %}>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: left;" class="{{ row.text_style|default:'normal' }}">
                                {{ row.name }}
                            </td>
                            {% for header in data.headers %}
                                <td style="border: 1px solid #ddd; padding: 8px; text-align: right;">
                                    {{ row.values|get_itemTest:header.id|default:"" }}
                                </td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p style="text-align: center; color: #666; font-size: 16px; margin-top: 20px;">
                No data available in this category for this stock.
            </p>
        {% endif %}
    {% endwith %}
</section>
<!-- financial-ratios section end -->
          <script>
              function showSection(id) 
              {
                  const sections = document.querySelectorAll('.content-section');
                  sections.forEach(sec => sec.style.display = 'none');

                  const overview = document.getElementById('overview');
                  if (id !== 'overview' && overview) {
                    overview.style.display = 'none';
                  }
                  const target = document.getElementById(id);
                  if (target) {
                    target.style.display = 'block';
                    window.scrollTo({
                      // top: target.offsetTop - 50,
                      behavior: 'smooth'
                    });
                  }
              }
          </script>
<!-- part 4 end -->

  <!-- part 5 start -->

        <!-- shareholder table start  -->
        <!-- <section class="stock-shareholding-section">
              {% load humanize %}
              {% if shareholdings %}
              <div class="stock-overview-text">
                <h2>Shareholding Pattern for {{ stock.company_name }}</h2>
              </div>
              <div class="stock-overview-table">
                <table>
                  <thead>
                    <tr style="background-color: #f2f2f2;">
                      <th>Shareholder</th>
                      <th>No. of Shares</th>
                      <th>% of Total</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for holder in shareholdings %}
                    <tr>
                      <td>{{ holder.shareholder_name }}</td>
                      <td>{{ holder.number_of_shares|intcomma }}</td>
                      <td>{{ holder.percentage_of_total|floatformat }}%</td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
              {% endif %}

        </section> -->
        <!-- shareholder table end  -->

        <!-- <main style="max-width: 1235px; margin: 0 auto; padding: 20px; font-family: &quot;Outfit&quot;, sans-serif;"> -->

                  <!-- statrt principalBusinessActivity -->
                    <!-- {% if principalBusinessActivity %}
                        <h2 style="color: #000;
                            font-size: 22px;
                            font-weight: 600;
                            margin-bottom: 20px;
                            margin-top: 20px;padding: 20px;">
                            {{stock.company_name}} Principal Business Activities </h2> 
                        <table class="table table-bordered" style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                          <thead>
                              <tr style="background-color: #f2f2f2;">
                                  <th style="text-align: left; padding: 10px; border: 1px solid #ccc;font-size: 18px;"> 
                                    Name and Description of main products/services</th>
                                  <th style="text-align: left; padding: 10px; border: 1px solid #ccc;font-size: 18px;">NIC Code of the product/service</th>
                                  <th style="text-align: left; padding: 10px; border: 1px solid #ccc;font-size: 18px;">% to total turnover of the Company</th>
                              </tr>
                          </thead>
                          <tbody>
                              {% for principalB in principalBusinessActivity %}
                                  <tr style="background-color: #f9f9f9;">
                                      <td style="padding: 10px; border: 1px solid #ccc;font-size: 18px;">{{ principalB.product_service_name }}</td>
                                      <td style="padding: 10px; border: 1px solid #ccc;font-size: 18px;">{{ principalB.nic_code }}</td>
                                      <td style="padding: 10px; border: 1px solid #ccc;font-size: 18px;">{{ principalB.turnover_percentage }}</td>
                                  </tr>
                              {% endfor %}
                          </tbody>
                        </table>
                    {% endif %} -->
                  <!-- end principalBusinessActivity -->

                  <!-- company subsidiary start -->
                    <!-- {% if relations %}
                        <h2 style="
                        color: #000;
                        font-size: 22px;
                        font-weight: 600;
                        margin-bottom: 20px;
                        margin-top: 20px;padding: 20px;">{{stock.company_name}} Particulars of Subsidiary and Associate Companies </h2> 
                        <table class="table table-bordered" style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                          <thead>
                              <tr style="background-color: #f2f2f2;">
                                  <th style="text-align: left; padding: 10px; border: 1px solid #ccc;font-size: 18px;">Company Name</th>
                                  <th style="text-align: left; padding: 10px; border: 1px solid #ccc;font-size: 18px;">Relation Type</th>
                                  {% if relations.first.percentage_shares_held %}
                                  <th style="text-align: left; padding: 10px; border: 1px solid #ccc;font-size: 18px;">%</th>
                                  {% endif %}
                              </tr>
                          </thead>
                          <tbody>
                              {% for relation in relations %}
                                  <tr style="background-color: #f9f9f9;">
                                      <td style="padding: 10px; border: 1px solid #ccc;font-size: 18px;">{{ relation.company_name }}</td>
                                      <td style="padding: 10px; border: 1px solid #ccc;font-size: 18px;">{{ relation.get_relation_type_display }}</td>
                                      {% if  relation.percentage_shares_held %}
                                      <td style="padding: 10px; border: 1px solid #ccc;font-size: 18px;">{{ relation.percentage_shares_held|floatformat:2 }}</td>
                                      {% endif %}
                                  </tr>
                              {% endfor %}
                          </tbody>
                        </table>
                    {% endif %} -->
                  <!-- company subsidary end -->

                  <!-- shareholder start  -->
                      <!-- {% load humanize %}
                      {% if shareholdings %}
                          <h2  style="
                          color: #000;
                          font-size: 22px;
                          font-weight: 600;
                          margin-bottom: 20px;
                          margin-top: 20px;padding: 20px;">
                          Shareholding Pattern for {{ stock.company_name }}</h2>
                          <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                              <thead>
                                  <tr style="background-color: #f2f2f2;">
                                      <th style="text-align: left; padding: 10px; border: 1px solid #ccc;font-size: 18px;">Shareholder</th>
                                      <th style="text-align: right; padding: 10px; border: 1px solid #ccc;font-size: 18px;">No. of Shares</th>
                                      <th style="text-align: right; padding: 10px; border: 1px solid #ccc;font-size: 18px;">% of Total</th>
                                  </tr>
                              </thead>
                              <tbody>
                                  {% for holder in shareholdings %}
                                      <tr>
                                          <td style="padding: 10px; border: 1px solid #ccc;font-size: 18px;">{{ holder.shareholder_name }}</td>
                                          <td style="padding: 10px; text-align: right; border: 1px solid #ccc;font-size: 18px;">{{ holder.number_of_shares|intcomma }}</td>
                                          <td style="padding: 10px; text-align: right; border: 1px solid #ccc;font-size: 18px;">{{ holder.percentage_of_total|floatformat }}%</td>
                                      </tr>
                                  {% endfor %}
                              </tbody>
                          </table>
                      {% endif %} -->
                  <!-- shareholder end -->

                      <!-- start FAQ -->
                        <!-- {% if faqs %}
                          {% if faqs is not None %}
                            <h2 style="
                            color: #000;
                            font-size: 22px;
                            font-weight: 600;
                            margin-bottom: 20px;
                            margin-top: 20px;padding: 20px;">FAQs for {{ stock.company_name }}</h2>
                            <ul style="list-style: none; padding: 0;">
                              {% for faq in faqs %}
                                <li style="margin-bottom: 20px; padding: 15px; background-color: #f0f8ff; border-left: 4px solid #007acc;font-size: larger;">
                                  <strong style="color: #007acc;">Q:</strong>
                                  <span style="font-weight: bold;">{{ faq.question }}</span><br>
                                  <strong style="color: #28a745;">A:</strong>
                                  <span>{{ faq.answer }}</span>
                                </li>
                              {% endfor %}
                            </ul>
                          {% endif %}
                        {% endif %} -->
                      <!-- End FAQ -->
        <!-- </main> -->

  <!-- part 5 end  -->   


<!-- part 6 Start  -->  
            <!-- most searched  start -->
            <main>          
                <div class="carousel-container-main">
                    <div class="carousel-title-main">
                        <span style="color: #000;"> Most Searched </span> <span style="color: #39B54A;">Unlisted</span>
                        <span style="color: #000;">&amp; </span>
                        <span style="color: #39B54A;">Pre IPO</span>
                        <span style="color: #000;">Companies Stocks in India</span>
  
                    </div>
                    <div class="carousel-content">
                        <div class="nav-arrow left" onclick="scrollLeftsroll()">
                            <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg" class="nav-arrow left" style="width: 40px; height: 40px; cursor: pointer">
                                <path d="M19.9052 14.8528L17.3342 12.2818L9.61789 19.9964L17.3324 27.7109L19.9033 25.1382L16.5815 21.8146H30.2852V18.1782H16.5815L19.9052 14.8528Z" fill="white"></path>
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M5.85818 5.85818C-1.95273 13.6691 -1.95273 26.3309 5.85818 34.1418C13.6691 41.9527 26.3309 41.9527 34.1418 34.1418C41.9527 26.3309 41.9527 13.6691 34.1418 5.85818C26.3309 -1.95273 13.6691 -1.95273 5.85818 5.85818ZM8.42909 8.42909C6.90958 9.9486 5.70424 11.7525 4.88188 13.7379C4.05952 15.7232 3.63626 17.8511 3.63626 20C3.63626 22.1489 4.05952 24.2768 4.88188 26.2621C5.70424 28.2475 6.90958 30.0514 8.42909 31.5709C9.9486 33.0904 11.7525 34.2958 13.7379 35.1181C15.7232 35.9405 17.8511 36.3637 20 36.3637C22.1489 36.3637 24.2768 35.9405 26.2621 35.1181C28.2475 34.2958 30.0514 33.0904 31.5709 31.5709C34.6397 28.5021 36.3637 24.3399 36.3637 20C36.3637 15.6601 34.6397 11.4979 31.5709 8.42909C28.5021 5.36029 24.3399 3.63626 20 3.63626C15.6601 3.63626 11.4979 5.36029 8.42909 8.42909Z" fill="white"></path>
                            </svg>
                        </div>
                        <div class="scroll-container-main" id="scrollContainer1">
                          {% for stock in all_stocks %}
                            <div class="company-card-main">
                                <!-- <div class="logo-main">
                                  {% if stock.logo %}
                                      <img src="{{ stock.logo.url }}" alt="{{ stock.company_name }} Logo" class="company-logo-main">
                                  {% endif %}
                                </div>
                                <div class="company-name-main">
                                    {{ stock.company_name }}
                                </div> -->
                                <a href="{% url 'unlisted_stock_marketplace:stock_detail' stock.id %}" 
                                  style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 12px;">
                                  
                                  <div style="width: 40px; height: 40px; flex-shrink: 0;">
                                    {% if stock.logo %}
                                      <img src="{{ stock.logo.url }}" alt="{{ stock.company_name }} Logo" 
                                          style="width: 100%; height: 100%; object-fit: contain;">
                                    {% endif %}
                                  </div>
                                  
                                  <div style="font-weight: 600; font-size: 1rem;">
                                    {{ stock.company_name }}
                                  </div>
                                  
                                </a>

                                <div class="company-sector-main"><span>Sector:</span>&nbsp;&nbsp;{{stock.sector}}</div>
                                <div class="company-ltp-main">
                                  <span>LTP:</span>
                                  {% if stock.ltp and stock.share_price %}
                                      {{ stock.ltp }}
                                      {% if stock.profit > 0 %}
                                          <p>
                                            <span style="color: green;">
                                              &#9650; ‚Çπ00{{ stock.profit }} ({{ stock.profit_percentage }}%)
                                            </span>
                                          </p>
                                      {% elif stock.profit < 0 %}
                                          <p>
                                            <span style="color: red;">
                                              &#9660; ‚Çπ{{ stock.profit }} ({{ stock.profit_percentage }}%)
                                            </span>
                                          </p>
                                      {% else %}
                                          <p>
                                            <span style="color: rgb(0, 0, 0);">
                                              ‚Çπ{{ stock.profit }} ({{ stock.profit_percentage }}%)
                                            </span>
                                          </p>
                                      {% endif %}
                                  {% else %}
                                      <span>No LTP data available</span>
                                  {% endif %}
                                </div>
                                <div class="market-cap-main"><span>Market Cap:</span>&nbsp;&nbsp;‚Çπ{{stock.market_capitalization}} Crore</div>
                                <div class="details-company-main">
                                    <div class="company-eps-div"><span>EPS:</span>‚Çπ{{stock.eps}}</div>
                                    <div class="company-eps-div"><span>PE Ratio:</span>{{stock.pe_ratio}}</div>
                                </div>
                                <div class="details-company-main">
                                    <div class="company-eps-div"><span>BV:</span>‚Çπ{{stock.book_value}}</div>
                                    <div class="company-eps-div"><span>P/BV:</span>{{stock.pbv}}</div>
                                </div>
                                <div class="details-company-main">
                                    <div class="company-eps-div"><span>FV:</span>‚Çπ{{stock.face_value}}</div>
                                    <div class="company-eps-div"><span>Shares:</span>{{stock.outstanding_shares}}</div>
                                </div>
                            </div>
                          {% endfor %}
                        </div>
                        <div class="nav-arrow right" onclick="scrollRightscroll()">
                          <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg" class="nav-arrow right" style="width: 40px; height: 40px; cursor: pointer">
                              <path d="M20.0948 25.1472L22.6658 27.7182L30.3821 20.0036L22.6676 12.2891L20.0967 14.8618L23.4185 18.1854H9.71484V21.8218H23.4185L20.0948 25.1472Z" fill="white"></path>
                              <path fill-rule="evenodd" clip-rule="evenodd" d="M34.1418 34.1418C41.9527 26.3309 41.9527 13.6691 34.1418 5.85818C26.3309 -1.95273 13.6691 -1.95273 5.85818 5.85818C-1.95273 13.6691 -1.95273 26.3309 5.85818 34.1418C13.6691 41.9527 26.3309 41.9527 34.1418 34.1418ZM31.5709 31.5709C33.0904 30.0514 34.2958 28.2475 35.1181 26.2621C35.9405 24.2768 36.3637 22.1489 36.3637 20C36.3637 17.8511 35.9405 15.7232 35.1181 13.7379C34.2958 11.7525 33.0904 9.9486 31.5709 8.42909C30.0514 6.90958 28.2475 5.70423 26.2621 4.88188C24.2768 4.05952 22.1489 3.63626 20 3.63626C17.8511 3.63626 15.7232 4.05952 13.7379 4.88188C11.7525 5.70423 9.9486 6.90958 8.42909 8.42909C5.3603 11.4979 3.63626 15.6601 3.63626 20C3.63626 24.3399 5.3603 28.5021 8.42909 31.5709C11.4979 34.6397 15.6601 36.3637 20 36.3637C24.3399 36.3637 28.5021 34.6397 31.5709 31.5709Z" fill="white"></path>
                          </svg>
                        </div>
                    </div>
                </div>
            </main>
          <!-- most searched  start -->
<!-- part 6 Start  -->            

    <!-- js for most searched start -->
    <script>
          function getVisibleCards() {
              const container = document.getElementById('scrollContainer1');
              const containerWidth = container.offsetWidth;
              const card = document.querySelector('.company-card-main');
              const cardWidth = card.offsetWidth + 15; // width + gap
              
              return Math.floor(containerWidth / cardWidth);
          }

          function scrollLeftsroll() {
              const container = document.getElementById('scrollContainer1');
              const cardsToScroll = getVisibleCards();
              const card = document.querySelector('.company-card-main');
              const scrollAmount = (card.offsetWidth + 15) * cardsToScroll;
              
              container.scrollBy({
                left: -scrollAmount,
                behavior: 'smooth'
              });
          }
            
          function scrollRightscroll() {
              const container = document.getElementById('scrollContainer1');
              const cardsToScroll = getVisibleCards();
              const card = document.querySelector('.company-card-main');
              const scrollAmount = (card.offsetWidth + 15) * cardsToScroll;
              
              container.scrollBy({
                left: scrollAmount,
                behavior: 'smooth'
              });
          }
    </script>
    <!-- js for most searched end -->
{% endblock %}