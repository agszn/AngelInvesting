{% extends "baseStructureRM.html" %}
{% block title %}Buy Order Transaction{% endblock %}
{% block SubTitleRM %}Buy Order Transaction{% endblock %}

{% block RMSearch_content %}
  <form method="get" style="margin-bottom: 20px;">
    <!-- Company Name Dropdown -->
    <select name="company_name">
      <option value="">-- Company Name --</option>
      {% for name in company_names %}
        <option value="{{ name }}" {% if request.GET.company_name == name %}selected{% endif %}>{{ name }}</option>
      {% endfor %}
    </select>

    <!-- Order ID Dropdown -->
    <select name="order_id">
      <option value="">-- Order ID --</option>
      {% for oid in order_ids %}
        <option value="{{ oid }}" {% if request.GET.order_id == oid %}selected{% endif %}>{{ oid }}</option>
      {% endfor %}
    </select>

    <!-- Date -->
    <input type="date" name="timestamp" value="{{ request.GET.timestamp }}">

    <!-- User Dropdown (filtered to assigned RM in view) -->
    <select name="user">
      <option value="">-- User --</option>
      {% for u in users %}
        <option value="{{ u.id }}" {% if request.GET.user == u.id|stringformat:"s" %}selected{% endif %}>
          {{ u.username }}
        </option>
      {% endfor %}
    </select>

    <!-- Broker Dropdown -->
    <select name="broker">
      <option value="">-- Broker --</option>
      {% for bro in brokers %}
        <option value="{{ bro.id }}" {% if request.GET.broker == bro.id|stringformat:"s" %}selected{% endif %}>
          {{ bro.name }}
        </option>
      {% endfor %}
    </select>

    <!-- Order Type -->
    <select name="order_type">
      <option value="">-- Order Type --</option>
      <option value="market" {% if request.GET.order_type == "market" %}selected{% endif %}>Market</option>
      <option value="limit" {% if request.GET.order_type == "limit" %}selected{% endif %}>Limit</option>
    </select>

    <button type="submit" class="btn btn-sm btn-outline-primary">üîç Filter</button>
    <a class="btn btn-sm btn-outline-primary" href="{% url 'RM_User:AllbuyTransactionSummary' %}">üîÑ Reset</a>
  </form>
{% endblock %}

{% block RMprofile_content %}
  <h6 style="padding-top: 2%;">Order Transaction Details</h6>

  <table class="RMbuyorder-table">
    <thead>
      <tr>
        <th>SLNO</th>
        <th>User</th>
        <th>Broker</th>
        <th>ISIN Number</th>
        <th>Stock</th>
        <th>Order Type</th>
        <th>Order ID</th>
        <th>Share Price</th>
        <th>Buy Price</th>
        <th>Qty</th>
        <th>Amount</th>
        <th>RM Status</th>
        <th>AC Status</th>
        <th>ST Status</th>

      </tr>
    </thead>
    <tbody>
      {% for item in TransactionDetails %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td>{{ item.user.username }}</td>
          <td>{{ item.broker.name }}</td>
          <td>{{ item.stock.isin_no }}</td>
          <td>{{ item.stock.company_name }}</td>
          <td>{{ item.order_type }}</td>
          <td>{{ item.order_id }}</td>
          <td>{{ item.stock.share_price }}</td>
          <td>{{ item.price_per_share }}</td>
          <td>{{ item.quantity }}</td>
          <td>{{ item.total_amount }}</td>
          <td>{{ item.get_RM_status_display }}</td>
          <td>{{ item.get_AC_status_display }}</td>
          <td>{{ item.get_status_display }}</td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="11" class="text-center">No transaction details available.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}
