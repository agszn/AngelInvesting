{% extends "baseStructureRM.html" %}

{% block title %}Sell Order Summary{% endblock %}
{% block SubTitleRM %}Sell Order Summary{% endblock %}

{% block RMprofile_content %}
  {% if order %}
    <h3>Order Details</h3>
    <table class="RMbuyorder-table">
      <thead>
        <tr>
          <th>Sl.no</th>
          <th>Order ID</th>
          <th>Date</th>
          <th>Time</th>
          <!-- <th>Client Name</th>
          <th>Client ID</th>
          <th>RM</th> -->
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>{{ order.id }}</td>
          <td>{{ order.order_id }}</td>
          <td>{{ order.timestamp|date:"d-m-Y" }}</td>
          <td>{{ order.timestamp|time:"h:i A" }}</td>
          <!-- <td>{{ order.user.profile.user.username }}</td>
          <td>{{ order.user.profile.custom_user_id }}</td>
          <td>{{ order.user.profile.user.assigned_rm }}</td> -->
        </tr>
      </tbody>
    </table>

    <h3>Client Details</h3>
    <table class="RMbuyorder-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Custom User ID</th>
          <th>PAN Number</th>
          <th>Email</th>
          <th>Mobile Number</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>{{ order.user.profile.user.username }}</td>
          <td>{{ order.user.profile.custom_user_id }}</td>
          <td>{{ order.user.profile.pan_number }}</td>
          <td>{{ order.user.email }}</td>
          <td>{{ order.user.profile.mobile_number }}</td>
        </tr>
      </tbody>
    </table>

    {% if cmr %}
      <h3>Broker Details</h3>
      <table class="RMbuyorder-table">
        <thead>
          <tr>
            <th>Broker Name</th>
            <th>Broker ID</th>
            <th>Client ID</th>
            <th>Broker PAN Number</th>
            <th>Broker Email</th>
            <th>Broker Contact</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>{{ cmr.broker.name }}</td>
            <td>{{ cmr.broker.broker_id }}</td>
            <td>{{ cmr.client_id_input }}</td>
            <td>{{ cmr.broker.pan }}</td>
            <td>{{ cmr.broker.email }}</td>
            <td>{{ cmr.broker.contact }}</td>
          </tr>
        </tbody>
      </table>
    {% else %}
      <p>No broker details found.</p>
    {% endif %}

    {% if bank_accounts %}
      <h3>Bank Account Details</h3>
      <table class="RMbuyorder-table">
        <thead>
          <tr>
            <th>Bank Name</th>
            <th>Account Holder Name</th>
            <th>Account Number</th>
            <th>IFSC Code</th>
            <th>Account Type</th>
          </tr>
        </thead>
        <tbody>
          {% for account in bank_accounts %}
          <tr>
            <td>{{ account.bank_name }}</td>
            <td>{{ account.account_holder_name }}</td>
            <td>{{ account.account_number }}</td>
            <td>{{ account.ifsc_code }}</td>
            <td>{{ account.account_type }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>No bank account details found.</p>
    {% endif %}

    <h3>Order Transaction Details</h3>
    <table class="RMbuyorder-table">
      <thead>
        <tr>
          <th>SLNO</th>
          <th>Broker</th>
          <th>ISIN Number</th>
          <th>Stock</th>
          <th>Order Type</th>
          <th>Avg Buy Price</th>
          <th>Selling Price</th>
          <th>Qty</th>
          <th>Amount</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        {% for item in order.buytransactionitem_set.all %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ item.broker.broker_name }}</td>
            <td>{{ item.isin_number }}</td>
            <td>{{ item.stock_data.company_name }}</td>
            <td>{{ item.order_type }}</td>
            <td>{{ item.avg_buy_price }}</td>
            <td>
              <input type="number" class="form-control" value="{{ item.selling_price }}" readonly>
            </td>

            <td>{{ item.quantity }}</td>
            <td>{{ item.amount }}</td>
            <td>{{ item.status }}</td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="10">No transaction details available.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <div class="RMpayment-process">
      <h4><strong>Total Amount: </strong> {{ order.total_amount }}</h4>
      <button class="RMpayment-button">Process To Account Department</button>
    </div>

  {% else %}
    <p>No order details found.</p>
  {% endif %}
{% endblock %}
